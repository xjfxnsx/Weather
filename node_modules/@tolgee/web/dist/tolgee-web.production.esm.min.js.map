{"version":3,"file":"tolgee-web.production.esm.min.js","sources":["../../core/dist/tolgee.esm.js","../src/package/constants.ts","../src/package/tools/isSSR.ts","../src/package/observers/general/ElementMeta.ts","../src/package/observers/general/helpers.ts","../src/package/observers/general/ElementHighlighter.ts","../src/package/observers/general/MouseEventHandler.ts","../src/package/observers/general/ElementRegistry.ts","../src/package/observers/general/GeneralObserver.ts","../src/package/observers/general/ElementStore.ts","../src/package/observers/general/DomHelper.ts","../src/package/observers/general/NodeHandler.ts","../../../node_modules/.pnpm/fast-text-encoding@1.0.6/node_modules/fast-text-encoding/text.min.js","../src/package/observers/invisible/secret.ts","../src/package/observers/invisible/InvisibleWrapper.ts","../src/package/observers/invisible/ValueMemory.ts","../src/package/observers/text/helpers.ts","../src/package/observers/text/TextWrapper.ts","../src/package/TextObserver.ts","../src/package/ObserverPlugin.ts","../src/package/InvisibleObserver.ts","../src/package/tools/decodeApiKey.ts","../src/package/tools/url.ts","../src/package/DevBackend.ts","../src/package/tools/extension.ts","../src/package/BrowserExtensionPlugin/loadInContextLib.ts","../src/package/BrowserExtensionPlugin/constants.ts","../src/package/BrowserExtensionPlugin/BrowserExtensionPlugin.ts","../src/package/LanguageStorage.ts","../src/package/LanguageDetector.ts","../src/package/tools/detectLanguageFromHeaders.ts","../src/package/tools/getHeaderLanguages.ts","../src/package/BackendFetch.ts","../src/package/Tolgee.ts","../src/package/entry-production.ts"],"sourcesContent":["function isPromise(value) {\n    return Boolean(value && typeof value.then === 'function');\n}\nfunction valueOrPromise(value, callback) {\n    if (isPromise(value)) {\n        return Promise.resolve(value).then(callback);\n    }\n    else {\n        return callback(value);\n    }\n}\nfunction handleRegularOrAsyncErr(onError, createError, callback) {\n    function handle(e) {\n        const error = createError(e);\n        onError.emit(error);\n        // eslint-disable-next-line no-console\n        console.error(error);\n        throw error;\n    }\n    try {\n        const result = callback();\n        if (isPromise(result)) {\n            return result.catch(handle);\n        }\n        return result;\n    }\n    catch (e) {\n        handle(e);\n    }\n}\nfunction missingOptionError(option) {\n    const options = (Array.isArray(option) ? option : [option]).map((val) => `'${val}'`);\n    const lastPart = options.slice(-2).join(' or ');\n    const firstPart = options.slice(0, -2);\n    const stringifiedOptions = [...firstPart, lastPart].join(', ');\n    return `Tolgee: You need to specify ${stringifiedOptions} option`;\n}\nfunction isObject(item) {\n    return typeof item === 'object' && !Array.isArray(item) && item !== null;\n}\nfunction getFallback(value) {\n    if (typeof value === 'string') {\n        return [value];\n    }\n    if (Array.isArray(value)) {\n        return value;\n    }\n    return undefined;\n}\nfunction getFallbackArray(value) {\n    return getFallback(value) || [];\n}\nfunction getFallbackFromStruct(language, fallbackLanguage) {\n    if (isObject(fallbackLanguage)) {\n        return getFallbackArray(fallbackLanguage === null || fallbackLanguage === void 0 ? void 0 : fallbackLanguage[language]);\n    }\n    else {\n        return getFallbackArray(fallbackLanguage);\n    }\n}\nfunction unique(arr) {\n    return Array.from(new Set(arr));\n}\nfunction sanitizeUrl(url) {\n    return url ? url.replace(/\\/+$/, '') : url;\n}\nfunction getErrorMessage(error) {\n    if (typeof error === 'string') {\n        return error;\n    }\n    else if (typeof (error === null || error === void 0 ? void 0 : error.message) === 'string') {\n        return error.message;\n    }\n}\nconst defaultFetchFunction = (input, options) => fetch(input, options);\nfunction headersInitToRecord(headersInit) {\n    return Object.fromEntries(new Headers(headersInit).entries());\n}\nconst createFetchFunction = (fetchFn = defaultFetchFunction) => {\n    return (input, init) => {\n        let headers = headersInitToRecord(init === null || init === void 0 ? void 0 : init.headers);\n        if (headers['x-api-key']) {\n            headers = Object.assign({ 'x-tolgee-sdk-type': 'JS', 'x-tolgee-sdk-version': 'prerelease' }, headers);\n        }\n        return fetchFn(input, Object.assign(Object.assign({}, init), { headers }));\n    };\n};\n\nfunction EventEmitter(isActive) {\n    let handlers = [];\n    return Object.freeze({\n        listen(handler) {\n            const handlerWrapper = (e) => {\n                handler(e);\n            };\n            handlers.push(handlerWrapper);\n            return {\n                unsubscribe() {\n                    handlers = handlers.filter((i) => handlerWrapper !== i);\n                },\n            };\n        },\n        emit(data) {\n            if (isActive()) {\n                handlers.forEach((handler) => handler({ value: data }));\n            }\n        },\n    });\n}\n\nfunction EventEmitterSelective(isActive, getFallbackNs, getDefaultNs) {\n    const listeners = new Set();\n    const partialListeners = new Set();\n    function callHandlers(ns) {\n        // everything is implicitly subscribed to fallbacks\n        // as it can always fall through to it\n        const fallbackNamespaces = new Set(getFallbackNs());\n        partialListeners.forEach((handler) => {\n            const nsMatches = ns === undefined ||\n                (ns === null || ns === void 0 ? void 0 : ns.findIndex((ns) => fallbackNamespaces.has(ns) || handler.namespaces.has(ns))) !== -1;\n            if (nsMatches) {\n                handler.fn({ value: undefined });\n            }\n        });\n    }\n    let queue = [];\n    // merge events in queue into one event\n    function solveQueue() {\n        if (queue.length === 0) {\n            return;\n        }\n        const queueCopy = queue;\n        queue = [];\n        listeners.forEach((handler) => {\n            handler({ value: undefined });\n        });\n        let namespaces = new Set();\n        queueCopy.forEach((ns) => {\n            if (ns === undefined) {\n                // when no ns specified, it affects all namespaces\n                namespaces = undefined;\n            }\n            else if (namespaces !== undefined) {\n                ns.forEach((ns) => namespaces.add(ns));\n            }\n        });\n        const namespacesArray = namespaces\n            ? Array.from(namespaces.keys())\n            : undefined;\n        callHandlers(namespacesArray);\n    }\n    return Object.freeze({\n        emit(ns, delayed) {\n            if (isActive()) {\n                queue.push(ns);\n                if (!delayed) {\n                    solveQueue();\n                }\n                else {\n                    setTimeout(solveQueue, 0);\n                }\n            }\n        },\n        listen(handler) {\n            listeners.add(handler);\n            const result = {\n                unsubscribe: () => {\n                    listeners.delete(handler);\n                },\n            };\n            return result;\n        },\n        listenSome(handler) {\n            const handlerWrapper = {\n                fn: (e) => {\n                    handler(e);\n                },\n                namespaces: new Set(),\n            };\n            partialListeners.add(handlerWrapper);\n            const result = {\n                unsubscribe: () => {\n                    partialListeners.delete(handlerWrapper);\n                },\n                subscribeNs: (ns) => {\n                    getFallbackArray(ns).forEach((val) => handlerWrapper.namespaces.add(val));\n                    if (ns === undefined) {\n                        // subscribing to default ns\n                        handlerWrapper.namespaces.add(getDefaultNs());\n                    }\n                    return result;\n                },\n            };\n            return result;\n        },\n    });\n}\n\nfunction Events(getFallbackNs, getDefaultNs) {\n    let emitterActive = true;\n    function isActive() {\n        return emitterActive;\n    }\n    const self = Object.freeze({\n        onPendingLanguageChange: EventEmitter(isActive),\n        onLanguageChange: EventEmitter(isActive),\n        onLoadingChange: EventEmitter(isActive),\n        onFetchingChange: EventEmitter(isActive),\n        onInitialLoaded: EventEmitter(isActive),\n        onRunningChange: EventEmitter(isActive),\n        onCacheChange: EventEmitter(isActive),\n        onUpdate: EventEmitterSelective(isActive, getFallbackNs, getDefaultNs),\n        onPermanentChange: EventEmitter(isActive),\n        onError: EventEmitter(isActive),\n        setEmitterActive(active) {\n            emitterActive = active;\n        },\n        on: ((event, handler) => {\n            switch (event) {\n                case 'pendingLanguage':\n                    return self.onPendingLanguageChange.listen(handler);\n                case 'language':\n                    return self.onLanguageChange.listen(handler);\n                case 'loading':\n                    return self.onLoadingChange.listen(handler);\n                case 'fetching':\n                    return self.onFetchingChange.listen(handler);\n                case 'initialLoad':\n                    return self.onInitialLoaded.listen(handler);\n                case 'running':\n                    return self.onRunningChange.listen(handler);\n                case 'cache':\n                    return self.onCacheChange.listen(handler);\n                case 'update':\n                    return self.onUpdate.listen(handler);\n                case 'permanentChange':\n                    return self.onPermanentChange.listen(handler);\n                case 'error':\n                    return self.onError.listen(handler);\n            }\n        }),\n    });\n    self.onInitialLoaded.listen(() => self.onUpdate.emit());\n    self.onLanguageChange.listen(() => self.onUpdate.emit());\n    self.onCacheChange.listen(({ value }) => self.onUpdate.emit([value.namespace], true));\n    return self;\n}\n\nclass RecordFetchError extends Error {\n    constructor(descriptor, cause, isDev = false) {\n        const { language, namespace } = descriptor;\n        super(`Tolgee: Failed to fetch record for \"${language}\"${namespace && ` and \"${namespace}\"`}`);\n        this.cause = cause;\n        this.isDev = isDev;\n        this.name = 'RecordFetchError';\n        this.language = language;\n        this.namespace = namespace;\n    }\n}\nclass LanguageDetectorError extends Error {\n    constructor(message, cause) {\n        super(message);\n        this.cause = cause;\n        this.name = 'LanguageDetectorError';\n    }\n}\nclass LanguageStorageError extends Error {\n    constructor(message, cause) {\n        super(message);\n        this.cause = cause;\n        this.name = 'LanguageStorageError';\n    }\n}\n\nconst flattenTranslations = (data) => {\n    const result = new Map();\n    Object.entries(data).forEach(([key, value]) => {\n        // ignore empty values\n        if (value === undefined || value === null) {\n            return;\n        }\n        if (typeof value === 'object') {\n            flattenTranslations(value).forEach((flatValue, flatKey) => {\n                result.set(key + '.' + flatKey, flatValue);\n            });\n            return;\n        }\n        result.set(key, value);\n    });\n    return result;\n};\nconst decodeCacheKey = (key) => {\n    const [firstPart, ...rest] = key.split(':');\n    // if namespaces contains \":\" it won't get lost\n    const secondPart = rest.join(':');\n    return { language: firstPart, namespace: secondPart || '' };\n};\nconst encodeCacheKey = ({ language, namespace, }) => {\n    if (namespace) {\n        return `${language}:${namespace}`;\n    }\n    else {\n        return language;\n    }\n};\n\nfunction Cache(events, backendGetRecord, backendGetDevRecord, withDefaultNs, isInitialLoading, fetchingObserver, loadingObserver) {\n    const asyncRequests = new Map();\n    const cache = new Map();\n    let staticData = {};\n    let version = 0;\n    function addRecordInternal(descriptor, data, recordVersion) {\n        const cacheKey = encodeCacheKey(descriptor);\n        cache.set(cacheKey, {\n            data: flattenTranslations(data),\n            version: recordVersion,\n        });\n        events.onCacheChange.emit(descriptor);\n    }\n    /**\n     * Fetches production data\n     */\n    async function fetchProd(keyObject) {\n        function handleError(e) {\n            const error = new RecordFetchError(keyObject, e);\n            events.onError.emit(error);\n            // eslint-disable-next-line no-console\n            console.error(error);\n            throw error;\n        }\n        const dataFromBackend = backendGetRecord(keyObject);\n        if (isPromise(dataFromBackend)) {\n            const result = await dataFromBackend.catch(handleError);\n            if (result !== undefined) {\n                return result;\n            }\n        }\n        const staticDataValue = staticData[encodeCacheKey(keyObject)];\n        if (typeof staticDataValue === 'function') {\n            try {\n                return await staticDataValue();\n            }\n            catch (e) {\n                handleError(e);\n            }\n        }\n        else {\n            return staticDataValue;\n        }\n    }\n    async function fetchData(keyObject, isDev) {\n        let result = undefined;\n        if (isDev) {\n            try {\n                result = await backendGetDevRecord(keyObject);\n            }\n            catch (e) {\n                const error = new RecordFetchError(keyObject, e, true);\n                events.onError.emit(error);\n                // eslint-disable-next-line no-console\n                console.warn(error);\n            }\n        }\n        if (!result) {\n            result = await fetchProd(keyObject);\n        }\n        return result;\n    }\n    const self = Object.freeze({\n        addStaticData(data) {\n            if (data) {\n                staticData = Object.assign(Object.assign({}, staticData), data);\n                Object.entries(data).forEach(([key, value]) => {\n                    if (typeof value !== 'function') {\n                        const descriptor = decodeCacheKey(key);\n                        const existing = cache.get(key);\n                        if (!existing || existing.version === 0) {\n                            addRecordInternal(descriptor, value, 0);\n                        }\n                    }\n                });\n            }\n        },\n        invalidate() {\n            asyncRequests.clear();\n            version += 1;\n        },\n        addRecord(descriptor, data) {\n            addRecordInternal(descriptor, data, version);\n        },\n        exists(descriptor, strict = false) {\n            const record = cache.get(encodeCacheKey(descriptor));\n            if (record && strict) {\n                return record.version === version;\n            }\n            return Boolean(record);\n        },\n        getRecord(descriptor) {\n            var _a;\n            return (_a = cache.get(encodeCacheKey(withDefaultNs(descriptor)))) === null || _a === void 0 ? void 0 : _a.data;\n        },\n        getTranslation(descriptor, key) {\n            var _a;\n            return (_a = cache.get(encodeCacheKey(descriptor))) === null || _a === void 0 ? void 0 : _a.data.get(key);\n        },\n        getTranslationNs(namespaces, languages, key) {\n            var _a;\n            for (const namespace of namespaces) {\n                for (const language of languages) {\n                    const value = (_a = cache\n                        .get(encodeCacheKey({ language, namespace }))) === null || _a === void 0 ? void 0 : _a.data.get(key);\n                    if (value !== undefined && value !== null) {\n                        return [namespace];\n                    }\n                }\n            }\n            return unique(namespaces);\n        },\n        getTranslationFallback(namespaces, languages, key) {\n            var _a;\n            for (const namespace of namespaces) {\n                for (const language of languages) {\n                    const value = (_a = cache\n                        .get(encodeCacheKey({ language, namespace }))) === null || _a === void 0 ? void 0 : _a.data.get(key);\n                    if (value !== undefined && value !== null) {\n                        return value;\n                    }\n                }\n            }\n            return undefined;\n        },\n        changeTranslation(descriptor, key, value) {\n            var _a;\n            const record = (_a = cache.get(encodeCacheKey(descriptor))) === null || _a === void 0 ? void 0 : _a.data;\n            record === null || record === void 0 ? void 0 : record.set(key, value);\n            events.onCacheChange.emit(Object.assign(Object.assign({}, descriptor), { key }));\n        },\n        isFetching(ns) {\n            if (isInitialLoading()) {\n                return true;\n            }\n            if (ns === undefined) {\n                return asyncRequests.size > 0;\n            }\n            const namespaces = getFallbackArray(ns);\n            return Boolean(Array.from(asyncRequests.keys()).find((key) => namespaces.includes(decodeCacheKey(key).namespace)));\n        },\n        isLoading(language, ns) {\n            const namespaces = getFallbackArray(ns);\n            return Boolean(isInitialLoading() ||\n                Array.from(asyncRequests.keys()).find((key) => {\n                    const descriptor = decodeCacheKey(key);\n                    return ((!namespaces.length ||\n                        namespaces.includes(descriptor.namespace)) &&\n                        !self.exists({\n                            namespace: descriptor.namespace,\n                            language: language,\n                        }));\n                }));\n        },\n        async loadRecords(descriptors, isDev) {\n            const withPromises = descriptors.map((descriptor) => {\n                const keyObject = withDefaultNs(descriptor);\n                const cacheKey = encodeCacheKey(keyObject);\n                const existingPromise = asyncRequests.get(cacheKey);\n                if (existingPromise) {\n                    return {\n                        new: false,\n                        promise: existingPromise,\n                        keyObject,\n                        cacheKey,\n                    };\n                }\n                const dataPromise = fetchData(keyObject, isDev) || Promise.resolve(undefined);\n                asyncRequests.set(cacheKey, dataPromise);\n                return {\n                    new: true,\n                    promise: dataPromise,\n                    keyObject,\n                    cacheKey,\n                };\n            });\n            fetchingObserver.notify();\n            loadingObserver.notify();\n            const results = await Promise.all(withPromises.map((val) => val.promise));\n            withPromises.forEach((value, i) => {\n                const promiseChanged = asyncRequests.get(value.cacheKey) !== value.promise;\n                // if promise has changed in between, it means cache been invalidated or\n                // new data are being fetched\n                if (value.new && !promiseChanged) {\n                    asyncRequests.delete(value.cacheKey);\n                    const data = results[i];\n                    if (data) {\n                        self.addRecord(value.keyObject, data);\n                    }\n                    else if (!self.getRecord(value.keyObject)) {\n                        // if no data exist, put empty object\n                        self.addRecord(value.keyObject, {});\n                    }\n                }\n            });\n            fetchingObserver.notify();\n            loadingObserver.notify();\n            return withPromises.map((val) => self.getRecord(val.keyObject));\n        },\n        getAllRecords() {\n            const entries = Array.from(cache.entries());\n            return entries.map(([key, entry]) => {\n                return Object.assign(Object.assign({}, decodeCacheKey(key)), { data: entry.data });\n            });\n        },\n    });\n    return self;\n}\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\n\nconst defaultObserverOptions = {\n    tagAttributes: {\n        textarea: ['placeholder'],\n        input: ['value', 'placeholder'],\n        img: ['alt'],\n        '*': ['aria-label', 'title'],\n    },\n    restrictedElements: ['script', 'style'],\n    highlightKeys: ['Alt'],\n    highlightColor: 'rgb(255, 0, 0)',\n    highlightWidth: 5,\n    inputPrefix: '%-%tolgee:',\n    inputSuffix: '%-%',\n    passToParent: ['option', 'optgroup'],\n    fullKeyEncode: false,\n};\n\nconst DEFAULT_FORMAT_ERROR = 'invalid';\nconst DEFAULT_API_URL = 'https://app.tolgee.io';\nconst DEFAULT_MISSING_TRANSLATION = ({ key, }) => key;\nconst defaultValues = {\n    defaultNs: '',\n    observerOptions: defaultObserverOptions,\n    observerType: 'invisible',\n    onFormatError: DEFAULT_FORMAT_ERROR,\n    apiUrl: DEFAULT_API_URL,\n    fetch: createFetchFunction(),\n    onTranslationMissing: DEFAULT_MISSING_TRANSLATION,\n};\nconst combineOptions = (...states) => {\n    let result = {};\n    states.forEach((state) => {\n        result = Object.assign(Object.assign(Object.assign({}, result), state), { observerOptions: Object.assign(Object.assign({}, result.observerOptions), state === null || state === void 0 ? void 0 : state.observerOptions) });\n    });\n    return result;\n};\nfunction initState(options, previousState) {\n    const initialOptions = combineOptions(defaultValues, previousState === null || previousState === void 0 ? void 0 : previousState.initialOptions, options);\n    // remove extra '/' from url end\n    initialOptions.apiUrl = sanitizeUrl(initialOptions.apiUrl);\n    if (options === null || options === void 0 ? void 0 : options.fetch) {\n        initialOptions.fetch = createFetchFunction(options.fetch);\n    }\n    return {\n        initialOptions,\n        activeNamespaces: (previousState === null || previousState === void 0 ? void 0 : previousState.activeNamespaces) || new Map(),\n        language: previousState === null || previousState === void 0 ? void 0 : previousState.language,\n        pendingLanguage: previousState === null || previousState === void 0 ? void 0 : previousState.language,\n        isInitialLoading: false,\n        isRunning: false,\n    };\n}\n\nfunction Plugins(getLanguage, getInitialOptions, getAvailableLanguages, getFallbackNamespaces, getTranslationNs, getTranslation, changeTranslation, events) {\n    const plugins = {\n        ui: undefined,\n    };\n    const instances = {\n        formatters: [],\n        finalFormatter: undefined,\n        observer: undefined,\n        devBackend: undefined,\n        backends: [],\n        ui: undefined,\n        languageDetector: undefined,\n        languageStorage: undefined,\n    };\n    const onClick = async ({ keysAndDefaults, target }) => {\n        var _a;\n        const withNs = keysAndDefaults.map(({ key, ns, defaultValue }) => {\n            return {\n                key,\n                defaultValue,\n                fallbackNamespaces: getFallbackNamespaces(ns),\n                namespace: getTranslationNs({ key, ns })[0],\n                translation: getTranslation({\n                    key,\n                    ns,\n                }),\n            };\n        });\n        (_a = instances.ui) === null || _a === void 0 ? void 0 : _a.handleElementClick(withNs, target);\n    };\n    const findPositions = (key, ns) => {\n        var _a;\n        return ((_a = instances.observer) === null || _a === void 0 ? void 0 : _a.findPositions(key, ns)) || [];\n    };\n    function translate(props) {\n        const translation = getTranslation({\n            key: props.key,\n            ns: props.ns,\n        });\n        return self.formatTranslation(Object.assign(Object.assign({}, props), { translation, formatEnabled: true }));\n    }\n    function getCommonProps() {\n        return { fetch: getInitialOptions().fetch };\n    }\n    function setObserver(observer) {\n        instances.observer = observer === null || observer === void 0 ? void 0 : observer();\n    }\n    function hasObserver() {\n        return Boolean(instances.observer);\n    }\n    function addFormatter(formatter) {\n        if (formatter) {\n            instances.formatters.push(formatter);\n        }\n    }\n    function setFinalFormatter(formatter) {\n        instances.finalFormatter = formatter;\n    }\n    function setUi(ui) {\n        plugins.ui = ui;\n    }\n    function hasUi() {\n        return Boolean(plugins.ui);\n    }\n    function setLanguageStorage(storage) {\n        instances.languageStorage = storage;\n    }\n    function setLanguageDetector(detector) {\n        instances.languageDetector = detector;\n    }\n    function storageLoadLanguage() {\n        return handleRegularOrAsyncErr(events.onError, (e) => new LanguageStorageError('Tolgee: Failed to load language', e), () => { var _a; return (_a = instances.languageStorage) === null || _a === void 0 ? void 0 : _a.getLanguage(getCommonProps()); });\n    }\n    function detectLanguage() {\n        if (!instances.languageDetector) {\n            return undefined;\n        }\n        const availableLanguages = getAvailableLanguages();\n        return handleRegularOrAsyncErr(events.onError, (e) => new LanguageDetectorError('Tolgee: Failed to detect language', e), () => {\n            var _a;\n            return (_a = instances.languageDetector) === null || _a === void 0 ? void 0 : _a.getLanguage(Object.assign({ availableLanguages }, getCommonProps()));\n        });\n    }\n    function addBackend(backend) {\n        if (backend) {\n            instances.backends.push(backend);\n        }\n    }\n    function setDevBackend(backend) {\n        instances.devBackend = backend;\n    }\n    function addPlugin(tolgeeInstance, plugin) {\n        const pluginTools = Object.freeze({\n            setFinalFormatter,\n            addFormatter,\n            setObserver,\n            hasObserver,\n            setUi,\n            hasUi,\n            setDevBackend,\n            addBackend,\n            setLanguageDetector,\n            setLanguageStorage,\n        });\n        plugin(tolgeeInstance, pluginTools);\n    }\n    const self = Object.freeze({\n        addPlugin,\n        findPositions: findPositions,\n        run() {\n            var _a, _b;\n            const { apiKey, apiUrl, projectId, observerOptions, tagNewKeys, filterTag, } = getInitialOptions();\n            instances.ui = (_a = plugins.ui) === null || _a === void 0 ? void 0 : _a.call(plugins, {\n                apiKey: apiKey,\n                apiUrl: apiUrl,\n                projectId,\n                highlight: self.highlight,\n                changeTranslation,\n                findPositions,\n                onPermanentChange: (data) => events.onPermanentChange.emit(data),\n                tagNewKeys,\n                filterTag,\n            });\n            (_b = instances.observer) === null || _b === void 0 ? void 0 : _b.run({\n                mouseHighlight: true,\n                options: observerOptions,\n                translate,\n                onClick,\n            });\n        },\n        stop() {\n            var _a;\n            instances.ui = undefined;\n            (_a = instances.observer) === null || _a === void 0 ? void 0 : _a.stop();\n        },\n        getLanguageStorage() {\n            return instances.languageStorage;\n        },\n        getInitialLanguage() {\n            const availableLanguages = getAvailableLanguages();\n            const languageOrPromise = storageLoadLanguage();\n            return valueOrPromise(languageOrPromise, (language) => {\n                if ((!availableLanguages || availableLanguages.includes(language)) &&\n                    language) {\n                    return language;\n                }\n                return detectLanguage();\n            });\n        },\n        setStoredLanguage(language) {\n            return handleRegularOrAsyncErr(events.onError, (e) => new LanguageStorageError('Tolgee: Failed to store language', e), () => { var _a; return (_a = instances.languageStorage) === null || _a === void 0 ? void 0 : _a.setLanguage(language, getCommonProps()); });\n        },\n        getDevBackend() {\n            return instances.devBackend;\n        },\n        getBackendRecord: (async ({ language, namespace }) => {\n            for (const backend of instances.backends) {\n                const data = await backend.getRecord(Object.assign({ language,\n                    namespace }, getCommonProps()));\n                if (data !== undefined) {\n                    return data;\n                }\n            }\n            return undefined;\n        }),\n        getBackendDevRecord: (async ({ language, namespace }) => {\n            var _a;\n            const { apiKey, apiUrl, projectId, filterTag } = getInitialOptions();\n            return (_a = instances.devBackend) === null || _a === void 0 ? void 0 : _a.getRecord(Object.assign({ apiKey,\n                apiUrl,\n                projectId,\n                language,\n                namespace,\n                filterTag }, getCommonProps()));\n        }),\n        getLanguageDetector() {\n            return instances.languageDetector;\n        },\n        retranslate() {\n            var _a;\n            (_a = instances.observer) === null || _a === void 0 ? void 0 : _a.retranslate();\n        },\n        highlight: ((key, ns) => {\n            var _a, _b;\n            return ((_b = (_a = instances.observer) === null || _a === void 0 ? void 0 : _a.highlight) === null || _b === void 0 ? void 0 : _b.call(_a, key, ns)) || { unhighlight() { } };\n        }),\n        unwrap(text) {\n            var _a;\n            if (instances.observer) {\n                return (_a = instances.observer) === null || _a === void 0 ? void 0 : _a.unwrap(text);\n            }\n            return { text, keys: [] };\n        },\n        wrap(params) {\n            var _a;\n            if (instances.observer) {\n                return (_a = instances.observer) === null || _a === void 0 ? void 0 : _a.wrap(params);\n            }\n            return params.translation;\n        },\n        hasDevBackend() {\n            return Boolean(self.getDevBackend());\n        },\n        formatTranslation(_a) {\n            var _b;\n            var { formatEnabled } = _a, props = __rest(_a, [\"formatEnabled\"]);\n            const { key, translation, defaultValue, noWrap, params, ns, orEmpty } = props;\n            const formattableTranslation = translation !== null && translation !== void 0 ? translation : defaultValue;\n            let translationMissingResult = '';\n            if (translation === undefined || translation === null) {\n                // called when translation is missing\n                // return value is used when 'defaultValue' and 'orEmpty' are not defined\n                translationMissingResult =\n                    getInitialOptions().onTranslationMissing(props);\n            }\n            let result = formattableTranslation !== null && formattableTranslation !== void 0 ? formattableTranslation : (orEmpty ? '' : translationMissingResult);\n            const language = getLanguage();\n            const isFormatEnabled = formatEnabled || !((_b = instances.observer) === null || _b === void 0 ? void 0 : _b.outputNotFormattable);\n            const wrap = (result) => {\n                if (instances.observer && !noWrap) {\n                    return instances.observer.wrap({\n                        key,\n                        translation: result,\n                        defaultValue,\n                        params,\n                        ns,\n                    });\n                }\n                return result;\n            };\n            result = wrap(result);\n            try {\n                if (formattableTranslation && language && isFormatEnabled) {\n                    for (const formatter of instances.formatters) {\n                        result = formatter.format({\n                            translation: result,\n                            language,\n                            params,\n                        });\n                    }\n                }\n                if (instances.finalFormatter &&\n                    formattableTranslation &&\n                    language &&\n                    isFormatEnabled) {\n                    result = instances.finalFormatter.format({\n                        translation: result,\n                        language,\n                        params,\n                    });\n                }\n            }\n            catch (e) {\n                // eslint-disable-next-line no-console\n                console.error(e);\n                const errorMessage = getErrorMessage(e) || DEFAULT_FORMAT_ERROR;\n                const onFormatError = getInitialOptions().onFormatError;\n                const formatErrorType = typeof onFormatError;\n                if (formatErrorType === 'string') {\n                    result = onFormatError;\n                }\n                else if (formatErrorType === 'function') {\n                    result = onFormatError(errorMessage, props);\n                }\n                else {\n                    result = DEFAULT_FORMAT_ERROR;\n                }\n                // wrap error message, so it's detectable\n                result = wrap(result);\n            }\n            return result;\n        },\n    });\n    return self;\n}\n\nconst ValueObserver = (initialValue, valueGetter, handler) => {\n    let previousValue = initialValue;\n    return Object.freeze({\n        init(value) {\n            previousValue = value;\n        },\n        notify() {\n            const value = valueGetter();\n            if (previousValue !== value) {\n                handler(value);\n            }\n            previousValue = value;\n        },\n    });\n};\n\nfunction State(onLanguageChange, onPendingLanguageChange, onRunningChange) {\n    let state = initState();\n    let devCredentials = undefined;\n    const self = Object.freeze({\n        init(options) {\n            state = initState(options, state);\n        },\n        isRunning() {\n            return state.isRunning;\n        },\n        setRunning(value) {\n            if (state.isRunning !== value) {\n                state.isRunning = value;\n                onRunningChange.emit(value);\n            }\n        },\n        isInitialLoading() {\n            return state.isInitialLoading;\n        },\n        setInitialLoading(value) {\n            state.isInitialLoading = value;\n        },\n        getLanguage() {\n            return state.language || state.initialOptions.language;\n        },\n        setLanguage(language) {\n            if (state.language !== language) {\n                state.language = language;\n                onLanguageChange.emit(language);\n            }\n        },\n        getPendingLanguage() {\n            return state.pendingLanguage || self.getLanguage();\n        },\n        setPendingLanguage(language) {\n            if (state.pendingLanguage !== language) {\n                state.pendingLanguage = language;\n                onPendingLanguageChange.emit(language);\n            }\n        },\n        getInitialOptions() {\n            return Object.assign(Object.assign({}, state.initialOptions), devCredentials);\n        },\n        addActiveNs(ns) {\n            const namespaces = getFallbackArray(ns);\n            namespaces.forEach((namespace) => {\n                const value = state.activeNamespaces.get(namespace);\n                if (value !== undefined) {\n                    state.activeNamespaces.set(namespace, value + 1);\n                }\n                else {\n                    state.activeNamespaces.set(namespace, 1);\n                }\n            });\n        },\n        removeActiveNs(ns) {\n            const namespaces = getFallbackArray(ns);\n            namespaces.forEach((namespace) => {\n                const value = state.activeNamespaces.get(namespace);\n                if (value !== undefined && value > 1) {\n                    state.activeNamespaces.set(namespace, value - 1);\n                }\n                else {\n                    state.activeNamespaces.delete(namespace);\n                }\n            });\n        },\n        getRequiredNamespaces() {\n            return unique([\n                ...(state.initialOptions.ns || [state.initialOptions.defaultNs]),\n                ...getFallbackArray(state.initialOptions.fallbackNs),\n                ...state.activeNamespaces.keys(),\n            ]);\n        },\n        getFallbackLangs(lang) {\n            const language = lang || self.getLanguage();\n            if (!language) {\n                return [];\n            }\n            return unique([\n                language,\n                ...getFallbackFromStruct(language, state.initialOptions.fallbackLanguage),\n            ]);\n        },\n        getFallbackNs() {\n            return getFallbackArray(state.initialOptions.fallbackNs);\n        },\n        getDefaultNs(ns) {\n            return ns === undefined ? state.initialOptions.defaultNs : ns;\n        },\n        getAvailableLanguages() {\n            if (state.initialOptions.availableLanguages) {\n                return state.initialOptions.availableLanguages;\n            }\n            else if (state.initialOptions.staticData) {\n                const languagesFromStaticData = Object.keys(state.initialOptions.staticData).map((key) => decodeCacheKey(key).language);\n                return Array.from(new Set(languagesFromStaticData));\n            }\n        },\n        withDefaultNs(descriptor) {\n            return {\n                namespace: descriptor.namespace === undefined\n                    ? self.getInitialOptions().defaultNs\n                    : descriptor.namespace,\n                language: descriptor.language,\n            };\n        },\n        overrideCredentials(credentials) {\n            if (credentials) {\n                devCredentials = Object.assign(Object.assign({}, credentials), { apiUrl: sanitizeUrl(credentials.apiUrl) });\n            }\n            else {\n                devCredentials = undefined;\n            }\n        },\n    });\n    return self;\n}\n\nfunction parseCombinedOptions(_a) {\n    var { ns, noWrap, orEmpty, params, language } = _a, rest = __rest(_a, [\"ns\", \"noWrap\", \"orEmpty\", \"params\", \"language\"]);\n    const options = {\n        ns: ns,\n        noWrap: noWrap,\n        orEmpty: orEmpty,\n        language: language,\n    };\n    return Object.assign(Object.assign({}, options), { params: Object.assign({}, rest) });\n}\nconst getTranslateProps = (keyOrProps, ...params) => {\n    let result = {};\n    let options;\n    if (typeof keyOrProps === 'object') {\n        result = keyOrProps;\n    }\n    else {\n        result.key = keyOrProps;\n        if (typeof params[0] === 'string') {\n            result.defaultValue = params[0];\n            options = params[1];\n        }\n        else if (typeof params[0] === 'object') {\n            options = params[0];\n        }\n    }\n    if (options) {\n        result = Object.assign(Object.assign({}, parseCombinedOptions(options)), result);\n    }\n    return result;\n};\n\nfunction Controller({ options }) {\n    const events = Events(getFallbackNs, getDefaultNs);\n    const fetchingObserver = ValueObserver(false, () => cache.isFetching(), events.onFetchingChange.emit);\n    const loadingObserver = ValueObserver(false, () => self.isLoading(), events.onLoadingChange.emit);\n    const state = State(events.onLanguageChange, events.onPendingLanguageChange, events.onRunningChange);\n    const pluginService = Plugins(state.getLanguage, state.getInitialOptions, state.getAvailableLanguages, getDefaultAndFallbackNs, getTranslationNs, getTranslation, changeTranslation, events);\n    const cache = Cache(events, pluginService.getBackendRecord, pluginService.getBackendDevRecord, state.withDefaultNs, state.isInitialLoading, fetchingObserver, loadingObserver);\n    if (options) {\n        init(options);\n    }\n    let runPromise;\n    events.onUpdate.listen(() => {\n        if (state.isRunning()) {\n            pluginService.retranslate();\n        }\n    });\n    function getFallbackNs() {\n        return state.getFallbackNs();\n    }\n    function getDefaultNs(ns) {\n        return state.getDefaultNs(ns);\n    }\n    // gets all namespaces where translation could be located\n    // takes (ns|default, fallback ns)\n    function getDefaultAndFallbackNs(ns) {\n        return [...getFallbackArray(getDefaultNs(ns)), ...getFallbackNs()];\n    }\n    // gets all namespaces which need to be loaded\n    // takes (ns|default, initial ns, fallback ns, active ns)\n    function getRequiredNamespaces(ns) {\n        return [\n            ...getFallbackArray(ns !== null && ns !== void 0 ? ns : getDefaultNs()),\n            ...state.getRequiredNamespaces(),\n        ];\n    }\n    function changeTranslation(descriptor, key, value) {\n        const keyObject = state.withDefaultNs(descriptor);\n        const previousValue = cache.getTranslation(keyObject, key);\n        cache.changeTranslation(keyObject, key, value);\n        return {\n            revert() {\n                cache.changeTranslation(keyObject, key, previousValue);\n            },\n        };\n    }\n    function init(options) {\n        state.init(options);\n        cache.addStaticData(state.getInitialOptions().staticData);\n    }\n    function getRequiredRecords(lang, ns) {\n        const languages = state.getFallbackLangs(lang);\n        const namespaces = getRequiredNamespaces(ns);\n        const result = [];\n        languages.forEach((language) => {\n            namespaces.forEach((namespace) => {\n                if (!cache.exists({ language, namespace }, true)) {\n                    result.push({ language, namespace });\n                }\n            });\n        });\n        return result;\n    }\n    function loadRequiredRecords(lang, ns) {\n        const descriptors = getRequiredRecords(lang, ns);\n        if (descriptors.length) {\n            return valueOrPromise(self.loadRecords(descriptors), () => { });\n        }\n    }\n    function getTranslationNs({ key, ns }) {\n        const languages = state.getFallbackLangs();\n        const namespaces = getDefaultAndFallbackNs(ns !== null && ns !== void 0 ? ns : undefined);\n        return cache.getTranslationNs(namespaces, languages, key);\n    }\n    function getTranslation({ key, ns, language }) {\n        const namespaces = getDefaultAndFallbackNs(ns !== null && ns !== void 0 ? ns : undefined);\n        const languages = state.getFallbackLangs(language);\n        return cache.getTranslationFallback(namespaces, languages, key);\n    }\n    function loadInitial() {\n        const data = valueOrPromise(initializeLanguage(), () => {\n            // fail if there is no language\n            return loadRequiredRecords();\n        });\n        if (isPromise(data)) {\n            state.setInitialLoading(true);\n            fetchingObserver.notify();\n            loadingObserver.notify();\n            return Promise.resolve(data).then(() => {\n                state.setInitialLoading(false);\n                fetchingObserver.notify();\n                loadingObserver.notify();\n                events.onInitialLoaded.emit();\n            });\n        }\n        else {\n            events.onInitialLoaded.emit();\n        }\n    }\n    function initializeLanguage() {\n        const existingLanguage = state.getLanguage();\n        if (existingLanguage) {\n            return;\n        }\n        const languageOrPromise = pluginService.getInitialLanguage();\n        return valueOrPromise(languageOrPromise, (lang) => {\n            const language = lang ||\n                state.getInitialOptions().defaultLanguage;\n            language && state.setLanguage(language);\n        });\n    }\n    function checkCorrectConfiguration() {\n        const languageComputable = pluginService.getLanguageDetector() || pluginService.getLanguageStorage();\n        if (languageComputable) {\n            const availableLanguages = state.getAvailableLanguages();\n            if (!availableLanguages) {\n                throw new Error(missingOptionError('availableLanguages'));\n            }\n        }\n        if (!state.getLanguage() && !state.getInitialOptions().defaultLanguage) {\n            throw new Error(missingOptionError(['defaultLanguage', 'language']));\n        }\n    }\n    const self = Object.freeze(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({}, events), state), pluginService), cache), { init: init, getTranslation: getTranslation, changeTranslation: changeTranslation, getTranslationNs: getTranslationNs, getDefaultAndFallbackNs: getDefaultAndFallbackNs, findPositions: pluginService.findPositions, getRequiredRecords: getRequiredRecords, async changeLanguage(language) {\n            if (state.getPendingLanguage() === language &&\n                state.getLanguage() === language) {\n                return;\n            }\n            state.setPendingLanguage(language);\n            if (state.isRunning()) {\n                await loadRequiredRecords(language);\n            }\n            if (language === state.getPendingLanguage()) {\n                // there might be parallel language change\n                // we only want to apply latest\n                state.setLanguage(language);\n                await pluginService.setStoredLanguage(language);\n            }\n        },\n        async addActiveNs(ns, forget) {\n            if (!forget) {\n                state.addActiveNs(ns);\n            }\n            if (state.isRunning()) {\n                await loadRequiredRecords(undefined, ns);\n            }\n        },\n        loadRecords(descriptors) {\n            return cache.loadRecords(descriptors, self.isDev());\n        },\n        async loadRecord(descriptor) {\n            return (await self.loadRecords([descriptor]))[0];\n        },\n        isLoading(ns) {\n            return cache.isLoading(state.getLanguage(), ns);\n        },\n        isLoaded(ns) {\n            const language = state.getLanguage();\n            if (!language) {\n                return false;\n            }\n            const languages = state.getFallbackLangs(language);\n            const namespaces = getRequiredNamespaces(ns);\n            const result = [];\n            languages.forEach((language) => {\n                namespaces.forEach((namespace) => {\n                    if (!cache.exists({ language, namespace })) {\n                        result.push({ language, namespace });\n                    }\n                });\n            });\n            return result.length === 0;\n        }, t: ((...args) => {\n            // @ts-ignore\n            const params = getTranslateProps(...args);\n            const translation = getTranslation(params);\n            return pluginService.formatTranslation(Object.assign(Object.assign({}, params), { translation }));\n        }), isDev() {\n            return Boolean(state.getInitialOptions().apiKey && state.getInitialOptions().apiUrl);\n        },\n        run() {\n            checkCorrectConfiguration();\n            if (!state.isRunning()) {\n                state.setRunning(true);\n                pluginService.run();\n                runPromise = loadInitial();\n            }\n            return Promise.resolve(runPromise);\n        },\n        stop() {\n            if (state.isRunning()) {\n                pluginService.stop();\n                state.setRunning(false);\n            }\n        } }));\n    return self;\n}\n\nfunction createTolgee(options) {\n    const controller = Controller({\n        options,\n    });\n    if (controller.isDev()) {\n        // override existing data in DevMode\n        controller.invalidate();\n    }\n    // restarts tolgee while applying callback\n    function withRestart(callback) {\n        const wasRunning = controller.isRunning();\n        wasRunning && controller.stop();\n        callback();\n        // invalidate cache when tolgee configuration is updated/plugin added in DevMode\n        controller.isDev() && controller.invalidate();\n        wasRunning && controller.run();\n    }\n    const self = Object.freeze({\n        /**\n         * Listen to tolgee events.\n         */\n        on: controller.on,\n        /**\n         * Listen for specific namespaces changes.\n         *\n         * ```\n         * const sub = tolgee.onUpdate(handler)\n         *\n         * // subscribe to selected namespace\n         * sub.subscribeNs(['common'])\n         *\n         * // unsubscribe\n         * sub.unsubscribe()\n         * ```\n         */\n        onNsUpdate: controller.onUpdate.listenSome,\n        /**\n         * Turn off/on events emitting. Is on by default.\n         */\n        setEmitterActive: controller.setEmitterActive,\n        /**\n         * @return current language if set.\n         */\n        getLanguage: controller.getLanguage,\n        /**\n         * `pendingLanguage` represents language which is currently being loaded.\n         * @return current `pendingLanguage` if set.\n         */\n        getPendingLanguage: controller.getPendingLanguage,\n        /**\n         * Change current language.\n         * - if not running sets `pendingLanguage`, `language` to the new value\n         * - if running sets `pendingLanguage` to the value, fetches necessary data and then changes `language`\n         *\n         * @return Promise which is resolved when `language` is changed.\n         */\n        changeLanguage: controller.changeLanguage,\n        /**\n         * Temporarily change translation in cache.\n         * @return object with revert method.\n         */\n        changeTranslation: controller.changeTranslation,\n        /**\n         * Adds namespace(s) list of active namespaces. And if tolgee is running, loads required data.\n         */\n        addActiveNs: controller.addActiveNs,\n        /**\n         * Remove namespace(s) from active namespaces.\n         *\n         * Tolgee internally counts how many times was each active namespace added,\n         * so this method will remove namespace only if the counter goes down to 0.\n         */\n        removeActiveNs: controller.removeActiveNs,\n        /**\n         * Manually load multiple records from `Backend` (or `DevBackend` when in dev mode)\n         *\n         * It loads data together and adds them to cache in one operation, to prevent partly loaded state.\n         */\n        loadRecords: controller.loadRecords,\n        /**\n         * Manually load record from `Backend` (or `DevBackend` when in dev mode)\n         */\n        loadRecord: controller.loadRecord,\n        /**\n         * Prefill static data\n         */\n        addStaticData: controller.addStaticData,\n        /**\n         * Get record from cache.\n         */\n        getRecord: controller.getRecord,\n        /**\n         * Get all records from cache.\n         */\n        getAllRecords: controller.getAllRecords,\n        /**\n         * @param ns optional list of namespaces that you are interested in\n         * @return `true` if there are data that need to be fetched.\n         */\n        isLoaded: controller.isLoaded,\n        /**\n         * Returns records needed for instance to be `loaded`\n         */\n        getRequiredRecords: controller.getRequiredRecords,\n        /**\n         * @return `true` if tolgee is loading initial data (triggered by `run`).\n         */\n        isInitialLoading: controller.isInitialLoading,\n        /**\n         * @param ns optional list of namespaces that you are interested in\n         * @return `true` if tolgee is loading some translations for the first time.\n         */\n        isLoading: controller.isLoading,\n        /**\n         * @param ns optional list of namespaces that you are interested in\n         * @return `true` if tolgee is fetching some translations.\n         */\n        isFetching: controller.isFetching,\n        /**\n         * @return `true` if tolgee is running.\n         */\n        isRunning: controller.isRunning,\n        /**\n         * Changes internal state to running: true and loads initial files.\n         * Runs runnable plugins mainly Observer if present.\n         */\n        run: controller.run,\n        /**\n         * Changes internal state to running: false and stops runnable plugins.\n         */\n        stop: controller.stop,\n        /**\n         * Returns translated and formatted key.\n         * If Observer is present and tolgee is running, wraps result to be identifiable in the DOM.\n         */\n        t: controller.t,\n        /**\n         * Highlight keys that match selection.\n         */\n        highlight: controller.highlight,\n        /**\n         * Find positions of keys in the DOM.\n         */\n        findPositions: controller.findPositions,\n        /**\n         * @return current Tolgee options.\n         */\n        getInitialOptions: controller.getInitialOptions,\n        /**\n         * Tolgee is in dev mode if `DevTools` plugin is used and `apiKey` + `apiUrl` are specified.\n         * @return `true` if tolgee is in dev mode.\n         */\n        isDev: controller.isDev,\n        /**\n         * Wraps translation if there is `Observer` plugin\n         */\n        wrap: controller.wrap,\n        /**\n         * Unwrap translation\n         */\n        unwrap: controller.unwrap,\n        /**\n         * Override creadentials passed on initialization.\n         *\n         * When called in running state, tolgee stops and runs again.\n         */\n        overrideCredentials(credentials) {\n            withRestart(() => controller.overrideCredentials(credentials));\n        },\n        /**\n         * Add tolgee plugin after initialization.\n         *\n         * When called in running state, tolgee stops and runs again.\n         */\n        addPlugin(plugin) {\n            if (plugin) {\n                withRestart(() => controller.addPlugin(self, plugin));\n            }\n        },\n        /**\n         * Updates options after instance creation. Extends existing options,\n         * so it only changes the fields, that are listed.\n         *\n         * When called in running state, tolgee stops and runs again.\n         */\n        updateOptions(options) {\n            if (options) {\n                withRestart(() => controller.init(options));\n            }\n        },\n    });\n    return self;\n}\n/**\n * Tolgee chainable constructor.\n *\n * Usage:\n * ```\n * const tolgee = Tolgee().use(...).init(...)\n * ```\n */\nconst TolgeeCore = () => {\n    const state = {\n        plugins: [],\n        options: {},\n    };\n    const tolgeeChain = Object.freeze({\n        use(plugin) {\n            state.plugins.push(plugin);\n            return tolgeeChain;\n        },\n        updateDefaults(options) {\n            state.options = combineOptions(state.options, options);\n            return tolgeeChain;\n        },\n        init(options) {\n            const tolgee = createTolgee(combineOptions(state.options, options));\n            state.plugins.forEach(tolgee.addPlugin);\n            return tolgee;\n        },\n    });\n    return tolgeeChain;\n};\n\nconst ERROR_PARAM_EMPTY = 0, ERROR_UNEXPECTED_CHAR = 1, ERROR_UNEXPECTED_END = 2;\nclass FormatError extends Error {\n    constructor(code, index, text) {\n        let error;\n        let hint = '';\n        if (code === ERROR_PARAM_EMPTY) {\n            error = 'Empty parameter';\n        }\n        else if (code === ERROR_UNEXPECTED_CHAR) {\n            error = 'Unexpected character';\n            hint = 'Did you forget to use FormatIcu to render ICU message syntax?';\n        }\n        else {\n            error = 'Unexpected end';\n        }\n        super(`Tolgee parser: ${error} at ${index} in \"${text}\"` +\n            (hint ? '\\n' + hint : ''));\n        this.code = code;\n        this.index = index;\n    }\n}\n\nfunction isWhitespace(ch) {\n    return /\\s/.test(ch);\n}\nconst STATE_TEXT = 0, STATE_ESCAPE_MAYBE = 1, STATE_ESCAPE = 2, STATE_PARAM = 3, STATE_PARAM_AFTER = 4;\nconst END_STATES = new Set([\n    STATE_ESCAPE,\n    STATE_ESCAPE_MAYBE,\n    STATE_TEXT,\n]);\nconst CHAR_ESCAPE = \"'\";\nconst ESCAPABLE = new Set(['{', '}', CHAR_ESCAPE]);\nconst isAllowedInParam = (char) => {\n    return /[0-9a-zA-Z_]/.test(char);\n};\nfunction formatParser(translation) {\n    let state = STATE_TEXT;\n    let text = '';\n    let param = '';\n    let ch = '';\n    const texts = [];\n    const params = [];\n    let i = 0;\n    function parsingError(code) {\n        throw new FormatError(code, i, translation);\n    }\n    const addText = () => {\n        texts.push(text);\n        text = '';\n    };\n    const addParamChar = () => {\n        if (!isAllowedInParam(ch)) {\n            parsingError(ERROR_UNEXPECTED_CHAR);\n        }\n        param += ch;\n    };\n    const addParam = () => {\n        if (param === '') {\n            parsingError(ERROR_PARAM_EMPTY);\n        }\n        params.push(param);\n        param = '';\n    };\n    for (i = 0; i < translation.length; i++) {\n        ch = translation[i];\n        switch (state) {\n            case STATE_TEXT:\n                if (ch === CHAR_ESCAPE) {\n                    text += ch;\n                    state = STATE_ESCAPE_MAYBE;\n                }\n                else if (ch === '{') {\n                    addText();\n                    state = STATE_PARAM;\n                }\n                else {\n                    text += ch;\n                    state = STATE_TEXT;\n                }\n                break;\n            case STATE_ESCAPE_MAYBE:\n                if (ESCAPABLE.has(ch)) {\n                    text = text.slice(0, -1) + ch;\n                    state = STATE_ESCAPE;\n                }\n                else {\n                    text += ch;\n                    state = STATE_TEXT;\n                }\n                break;\n            case STATE_ESCAPE:\n                if (ch === CHAR_ESCAPE) {\n                    state = STATE_TEXT;\n                }\n                else {\n                    text += ch;\n                    state = STATE_ESCAPE;\n                }\n                break;\n            case STATE_PARAM:\n                if (ch === '}') {\n                    addParam();\n                    state = STATE_TEXT;\n                }\n                else if (!isWhitespace(ch)) {\n                    addParamChar();\n                    state = STATE_PARAM;\n                }\n                else if (param !== '') {\n                    addParam();\n                    state = STATE_PARAM_AFTER;\n                }\n                break;\n            case STATE_PARAM_AFTER:\n                if (ch == '}') {\n                    state = STATE_TEXT;\n                }\n                else if (isWhitespace(ch)) {\n                    state = STATE_PARAM_AFTER;\n                }\n                else {\n                    parsingError(ERROR_UNEXPECTED_CHAR);\n                }\n        }\n    }\n    if (!END_STATES.has(state)) {\n        parsingError(ERROR_UNEXPECTED_END);\n    }\n    addText();\n    return [texts, params];\n}\n\nfunction formatter(translation, params) {\n    const [texts, pars] = formatParser(translation);\n    const result = [texts[0]];\n    for (let i = 1; i < texts.length; i++) {\n        const parameter = params === null || params === void 0 ? void 0 : params[pars[i - 1]];\n        if (parameter === undefined) {\n            throw new Error(`Missing parameter \"${pars[i - 1]}\" in \"${translation}\"`);\n        }\n        result.push(String(parameter));\n        result.push(texts[i]);\n    }\n    return result.join('');\n}\n\nfunction createFormatSimple() {\n    return {\n        format: ({ translation, params }) => formatter(translation, params),\n    };\n}\nconst FormatSimple = () => (tolgee, tools) => {\n    tools.setFinalFormatter(createFormatSimple());\n    return tolgee;\n};\n\nexport { FormatSimple, LanguageDetectorError, LanguageStorageError, RecordFetchError, TolgeeCore, createFetchFunction, getFallback, getFallbackArray, getTranslateProps };\n//# sourceMappingURL=tolgee.esm.js.map\n","// needs to be same as in @tolgee/core package\nexport const DEVTOOLS_ID = '__tolgee_dev_tools';\n\nexport const DEVTOOLS_Z_INDEX = 2147483000;\n\nexport const CHROME_EXTENSION_LINK =\n  'https://chrome.google.com/webstore/detail/tolgee-tools/hacnbapajkkfohnonhbmegojnddagfnj';\n\nexport const PREFERRED_LANGUAGES_LOCAL_STORAGE_KEY =\n  '__tolgee_preferredLanguages';\n\nexport const MAX_LANGUAGES_SELECTED = 5;\n\n/**\n * Use this if you want to indicate to tolgee that element contains key\n */\nexport const TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE = 'data-tolgee-key-only';\n/**\n * Use this attribute if you want tolgee Observer to not touch part of the DOM\n */\nexport const TOLGEE_RESTRICT_ATTRIBUTE = 'data-tolgee-restricted';\n/**\n * This attribute is present on elements that have been registred by tolgee and are clickable for in-context\n */\nexport const TOLGEE_ATTRIBUTE_NAME = '_tolgee';\nexport const TOLGEE_HIGHLIGHTER_CLASS = '_tolgee-highlighter';\n","export function isSSR() {\n  return typeof globalThis.window?.document?.createElement === 'undefined';\n}\n\nexport function throwIfSSR(origin: string) {\n  if (isSSR()) {\n    throw new Error(`${origin}: Can't run on the server`);\n  }\n}\n","import type { KeyAndParams } from '@tolgee/core';\nimport type { ElementMeta, NodeMeta, TolgeeElement } from '../../types';\n\nexport function initElementMeta(element: TolgeeElement): ElementMeta {\n  return {\n    element,\n    nodes: new Map(),\n  };\n}\n\nexport function initNodeMeta(\n  oldTextContent: string,\n  keys: KeyAndParams[]\n): NodeMeta {\n  return {\n    oldTextContent,\n    keys,\n  };\n}\n","import { KeyDescriptorInternal } from '../../types';\n\nexport function getNodeText(node: Node) {\n  return node.textContent;\n}\n\nexport function setNodeText(node: Node, text: string) {\n  node.textContent = text;\n}\n\nexport function compareDescriptors(\n  descriptor: KeyDescriptorInternal,\n  criteria: KeyDescriptorInternal\n) {\n  const keyMatches =\n    descriptor.key === undefined ||\n    criteria.key === undefined ||\n    criteria.key === descriptor.key;\n  const nsMatches =\n    descriptor.ns === undefined ||\n    criteria.ns === undefined ||\n    descriptor.ns?.findIndex((ns) => criteria.ns?.includes(ns)) !== -1;\n\n  return keyMatches && nsMatches;\n}\n\nexport function elementClickable(el: HTMLElement) {\n  while (el) {\n    if (el.getAttribute('disabled') !== null) {\n      return false;\n    }\n    el = el.parentElement;\n  }\n  return true;\n}\n","import { TOLGEE_HIGHLIGHTER_CLASS } from '../../constants';\nimport { ElementMeta, TolgeeElement } from '../../types';\nimport { elementClickable } from './helpers';\n\nconst HIGHLIGHTER_BASE_STYLE: Partial<CSSStyleDeclaration> = {\n  position: 'fixed',\n  boxSizing: 'content-box',\n  zIndex: String(Number.MAX_SAFE_INTEGER),\n  contain: 'layout',\n  display: 'block',\n  borderStyle: 'solid',\n  borderRadius: '4px',\n};\n\ntype Props = {\n  highlightColor: string;\n  highlightWidth: number;\n};\n\nexport function ElementHighlighter({ highlightColor, highlightWidth }: Props) {\n  function initHighlightFunction(\n    element: TolgeeElement,\n    elementMeta: ElementMeta\n  ) {\n    elementMeta.highlight = () => {\n      if (!element.isConnected) {\n        return;\n      }\n      const clickable = elementClickable(element);\n      let highlightEl = elementMeta.highlightEl;\n      if (!highlightEl) {\n        highlightEl = document.createElement('div');\n        highlightEl.classList.add(TOLGEE_HIGHLIGHTER_CLASS);\n        Object.entries(HIGHLIGHTER_BASE_STYLE).forEach(([key, value]) => {\n          // @ts-ignore\n          highlightEl!.style[key] = value;\n        });\n        highlightEl.style.borderColor = highlightColor;\n\n        elementMeta.highlightEl = highlightEl;\n        document.body.appendChild(highlightEl);\n      }\n\n      const shape = element.getBoundingClientRect();\n\n      highlightEl.style.pointerEvents = clickable ? 'none' : 'auto';\n      highlightEl.style.borderWidth = highlightWidth + 'px';\n      highlightEl.style.top = shape.top - highlightWidth + 'px';\n      highlightEl.style.left = shape.left - highlightWidth + 'px';\n      highlightEl.style.width = shape.width + 'px';\n      highlightEl.style.height = shape.height + 'px';\n    };\n  }\n\n  function initUnhighlightFunction(\n    element: TolgeeElement,\n    elementMeta: ElementMeta\n  ) {\n    elementMeta.unhighlight = () => {\n      elementMeta.highlightEl?.remove();\n      elementMeta.highlightEl = undefined;\n    };\n  }\n\n  return Object.freeze({\n    initHighlighter(element: TolgeeElement, elementMeta: ElementMeta) {\n      initHighlightFunction(element, elementMeta);\n      initUnhighlightFunction(element, elementMeta);\n    },\n  });\n}\n","import { ModifierKey, ObserverOptionsInternal } from '@tolgee/core';\nimport { TolgeeElement } from '../../types';\nimport { DEVTOOLS_ID } from '../../constants';\nimport { ElementStoreType } from './ElementStore';\n\nconst eCapture = {\n  capture: true,\n};\n\nconst ePassive = {\n  capture: true,\n  passive: true,\n};\n\ntype Coordinates = {\n  x: number;\n  y: number;\n};\n\ntype Props = {\n  highlightKeys: ModifierKey[];\n  elementStore: ElementStoreType;\n  onClick: (el: TolgeeElement) => void;\n  options: ObserverOptionsInternal;\n};\n\nconst MODIFIER_MAP = new Map<\n  ModifierKey,\n  'ctrlKey' | 'altKey' | 'metaKey' | 'shiftKey'\n>([\n  ['Control', 'ctrlKey'],\n  ['Alt', 'altKey'],\n  ['Meta', 'metaKey'],\n  ['Shift', 'shiftKey'],\n]);\n\nexport function MouseEventHandler({\n  highlightKeys,\n  elementStore,\n  onClick,\n  options,\n}: Props) {\n  const keysDown = new Set<ModifierKey>();\n  let highlighted: TolgeeElement | undefined;\n  let cursorPosition: Coordinates | undefined;\n  let subscribedEvents: [\n    type: string,\n    listener: EventListenerOrEventListenerObject,\n    options?: boolean | AddEventListenerOptions,\n  ][] = [];\n\n  const documentOrShadowRoot = (options.targetElement?.getRootNode() ||\n    document) as unknown as ShadowRoot;\n\n  const targetDocument = options.targetElement?.ownerDocument || document;\n\n  function highlight(el: TolgeeElement | undefined) {\n    if (highlighted !== el) {\n      unhighlight();\n      const meta = elementStore.get(el);\n      if (meta) {\n        meta.preventClean = true;\n        meta.highlight?.();\n        highlighted = el;\n      }\n    }\n  }\n\n  function unhighlight() {\n    const meta = elementStore.get(highlighted);\n    if (meta) {\n      meta.preventClean = false;\n      meta.unhighlight?.();\n      highlighted = undefined;\n    }\n  }\n\n  function updateHighlight() {\n    const position = cursorPosition;\n\n    let newHighlighted: TolgeeElement | undefined;\n    if (position && areKeysDown()) {\n      const elements =\n        documentOrShadowRoot.elementsFromPoint(position.x, position.y) || [];\n\n      newHighlighted = getClosestTolgeeElement(elements);\n    }\n    highlight(newHighlighted);\n  }\n\n  function updateCursorPosition(position: Coordinates) {\n    cursorPosition = position;\n    updateHighlight();\n  }\n\n  function updateModifiers(e: MouseEvent | KeyboardEvent) {\n    for (const [modifier, modifierProperty] of MODIFIER_MAP.entries()) {\n      if (keysDown.has(modifier) && !e[modifierProperty]) {\n        keysDown.delete(modifier);\n      } else if (!keysDown.has(modifier) && e[modifierProperty]) {\n        keysDown.add(modifier);\n      }\n    }\n  }\n\n  function blockEvents(e: MouseEvent) {\n    updateModifiers(e);\n    if (areKeysDown() && !isInUiDialog(e.target as Element)) {\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  }\n\n  function onMouseMove(e: MouseEvent) {\n    updateModifiers(e);\n    updateCursorPosition({ x: e.clientX, y: e.clientY });\n  }\n\n  function onKeyDown(e: KeyboardEvent) {\n    updateModifiers(e);\n    updateHighlight();\n  }\n\n  function onKeyUp(e: KeyboardEvent) {\n    updateModifiers(e);\n    updateHighlight();\n  }\n\n  function onScroll() {\n    const meta = elementStore.get(highlighted);\n    meta?.highlight?.();\n  }\n\n  function handleClick(e: MouseEvent) {\n    blockEvents(e);\n    updateModifiers(e);\n    updateCursorPosition({ x: e.clientX, y: e.clientY });\n    if (areKeysDown() && highlighted) {\n      onClick(highlighted);\n      unhighlight();\n    }\n  }\n\n  function subscribe<K extends keyof DocumentEventMap>(\n    type: K,\n    listener: (ev: DocumentEventMap[K]) => any,\n    options?: boolean | AddEventListenerOptions\n  ) {\n    targetDocument.addEventListener(type, listener, options);\n    subscribedEvents.push([type, listener as any, options]);\n  }\n\n  function initEventListeners() {\n    subscribe('keydown', onKeyDown, eCapture);\n    subscribe('keyup', onKeyUp, eCapture);\n    subscribe('mousemove', onMouseMove, ePassive);\n\n    subscribe('scroll', onScroll, ePassive);\n    subscribe('click', handleClick, eCapture);\n\n    subscribe('mouseenter', blockEvents, eCapture);\n    subscribe('mouseover', blockEvents, eCapture);\n    subscribe('mouseout', blockEvents, eCapture);\n    subscribe('mouseleave', blockEvents, eCapture);\n    subscribe('mousedown', blockEvents, eCapture);\n    subscribe('mouseup', blockEvents, eCapture);\n  }\n\n  function removeEventListeners() {\n    for (const params of subscribedEvents) {\n      targetDocument.removeEventListener(...params);\n    }\n    subscribedEvents = [];\n  }\n\n  function isInUiDialog(element: Element) {\n    return Boolean(findAncestor(element, (el) => el.id === DEVTOOLS_ID));\n  }\n\n  function getClosestTolgeeElement(\n    elements: Element[]\n  ): TolgeeElement | undefined {\n    for (const element of elements) {\n      const result = findAncestor(element, (el) =>\n        elementStore.get(el as TolgeeElement)\n      ) as TolgeeElement | undefined | null;\n\n      if (result !== undefined) {\n        return result || undefined;\n      }\n    }\n  }\n\n  function findAncestor(\n    element: Element,\n    func: (el: Element) => any\n  ): Element | undefined | null {\n    if (element.id === DEVTOOLS_ID) {\n      return null;\n    }\n    if (func(element)) {\n      return element;\n    }\n    if (element?.parentElement) {\n      return findAncestor(element.parentElement, func);\n    }\n    return undefined;\n  }\n\n  function areKeysDown() {\n    for (const key of highlightKeys) {\n      if (!keysDown.has(key)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  return Object.freeze({\n    stop() {\n      removeEventListeners();\n    },\n\n    run() {\n      initEventListeners();\n    },\n  });\n}\n","import { NsFallback, getFallback, ObserverOptionsInternal } from '@tolgee/core';\nimport { KeyAndParams, TranslationOnClick } from '@tolgee/core';\nimport {\n  TOLGEE_RESTRICT_ATTRIBUTE,\n  TOLGEE_ATTRIBUTE_NAME,\n  TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE,\n} from '../../constants';\nimport { ElementMeta, NodeMeta, TolgeeElement } from '../../types';\n\nimport { ElementHighlighter } from './ElementHighlighter';\nimport { initElementMeta } from './ElementMeta';\nimport { ElementStoreType } from './ElementStore';\nimport { compareDescriptors } from './helpers';\nimport { MouseEventHandler } from './MouseEventHandler';\n\nexport function ElementRegistry(\n  options: ObserverOptionsInternal,\n  elementStore: ElementStoreType,\n  onClick: TranslationOnClick\n) {\n  const elementHighlighter = ElementHighlighter({\n    highlightColor: options.highlightColor,\n    highlightWidth: options.highlightWidth,\n  });\n  const eventHandler = MouseEventHandler({\n    highlightKeys: options.highlightKeys,\n    elementStore,\n    onClick(el) {\n      const meta = elementStore.get(el)!;\n      onClick({\n        target: el as HTMLElement,\n        keysAndDefaults: getKeysAndDefaults(meta),\n      });\n    },\n    options,\n  });\n\n  function isRestricted(element: Element) {\n    const restrictedElements = options.restrictedElements;\n    return (\n      restrictedElements.indexOf(element.tagName.toLowerCase()) !== -1 ||\n      element.closest(`[${TOLGEE_RESTRICT_ATTRIBUTE}]`) !== null\n    );\n  }\n\n  function cleanElementInactiveNodes(\n    meta: ElementMeta,\n    removedNodes: Set<Node>\n  ) {\n    for (const [key] of meta.nodes) {\n      if (removedNodes.has(key)) {\n        meta.nodes.delete(key);\n      }\n    }\n  }\n\n  function cleanElement(element: TolgeeElement, meta: ElementMeta) {\n    if (meta.highlightEl) {\n      meta.unhighlight?.();\n    }\n    element.removeAttribute(TOLGEE_ATTRIBUTE_NAME);\n    elementStore.remove(element);\n  }\n\n  function getKeyOptions(meta: ElementMeta): KeyAndParams[] {\n    const nodes = Array.from(meta.nodes.values());\n    return nodes.reduce(\n      (acc, curr) => [\n        ...acc,\n        ...curr.keys.map((k) => ({\n          key: k.key,\n          defaultValue: k.defaultValue,\n          ns: k.ns,\n        })),\n      ],\n      [] as KeyAndParams[]\n    );\n  }\n\n  function getKeysAndDefaults(meta: ElementMeta): KeyAndParams[] {\n    return getKeyOptions(meta);\n  }\n\n  return Object.freeze({\n    isRestricted: isRestricted,\n    register(element: Element, node: Node, nodeMeta: NodeMeta) {\n      if (isRestricted(element)) {\n        return;\n      }\n      const tolgeeElement = element as TolgeeElement;\n      let elementMeta = elementStore.get(tolgeeElement);\n      if (!elementMeta) {\n        elementMeta = initElementMeta(tolgeeElement);\n        elementStore.set(tolgeeElement, elementMeta);\n        tolgeeElement.setAttribute(TOLGEE_ATTRIBUTE_NAME, 'true');\n      }\n      elementMeta.nodes.set(node, nodeMeta);\n      elementHighlighter.initHighlighter(tolgeeElement, elementMeta);\n    },\n\n    forEachElement: elementStore.forEachElement,\n\n    cleanupLingeringKeyAttributes() {\n      elementStore.forEachElement((element, meta) => {\n        if (meta.preventClean) {\n          return;\n        }\n        for (const [node] of meta.nodes) {\n          if (node.nodeType === Node.ATTRIBUTE_NODE) {\n            const attr = node as Attr;\n            if (\n              attr.name === TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE &&\n              attr.ownerElement === null\n            ) {\n              meta.nodes.delete(attr);\n            }\n          }\n        }\n        if (meta.nodes.size === 0) {\n          cleanElement(element, meta);\n        }\n      });\n    },\n\n    cleanupRemovedNodes(removedNodes: Set<Node>) {\n      elementStore.forEachElement((element, meta) => {\n        if (meta.preventClean) {\n          return;\n        }\n        if (!removedNodes.has(element)) {\n          cleanElementInactiveNodes(meta, removedNodes);\n        }\n        if (removedNodes.has(element) || meta.nodes.size === 0) {\n          cleanElement(element, meta);\n        }\n      });\n    },\n\n    findAll(key?: string, ns?: NsFallback) {\n      const result: ElementMeta[] = [];\n      elementStore.forEachElement((_, meta) => {\n        for (const nodeMeta of meta.nodes.values()) {\n          const fits = nodeMeta.keys.find((val) =>\n            compareDescriptors(\n              { key, ns: getFallback(ns) },\n              { key: val.key, ns: getFallback(val.ns) }\n            )\n          );\n          if (fits) {\n            result.push(meta);\n            break;\n          }\n        }\n      });\n      return result;\n    },\n\n    run(mouseHighlight: boolean) {\n      if (mouseHighlight) {\n        eventHandler.run();\n      }\n    },\n\n    stop() {\n      eventHandler.stop();\n      elementStore.forEachElement((_, meta) => {\n        if (meta.highlightEl) {\n          meta.unhighlight?.();\n        }\n      });\n    },\n  });\n}\n\nexport type ElementRegistryInstance = ReturnType<typeof ElementRegistry>;\n","import {\n  NsFallback,\n  ObserverRunProps,\n  Unwrapped,\n  WrapperMiddleware,\n  WrapperWrapProps,\n  KeyPosition,\n  getFallback,\n} from '@tolgee/core';\n\nimport { TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE } from '../../constants';\nimport { isSSR } from '../../tools/isSSR';\nimport { ElementMeta, TolgeeElement } from '../../types';\nimport { DomHelper } from './DomHelper';\nimport { initNodeMeta } from './ElementMeta';\nimport { ElementRegistry, ElementRegistryInstance } from './ElementRegistry';\nimport { ElementStore } from './ElementStore';\nimport { compareDescriptors, getNodeText, setNodeText } from './helpers';\nimport { NodeHandler } from './NodeHandler';\n\ntype RunningInstance = {\n  stop: () => void;\n  elementRegistry?: ElementRegistryInstance;\n  wrapper: WrapperMiddleware;\n};\n\ntype RunProps = ObserverRunProps & {\n  wrapper: WrapperMiddleware;\n};\n\nexport function GeneralObserver() {\n  let isObserving = false;\n  let instance: RunningInstance | undefined;\n\n  const elementStore = ElementStore();\n\n  function createRunningInstance({\n    mouseHighlight,\n    options,\n    wrapper,\n    onClick,\n  }: RunProps): RunningInstance | undefined {\n    if (isSSR()) {\n      return {\n        stop() {\n          isObserving = false;\n        },\n        wrapper,\n      };\n    }\n    const domHelper = DomHelper(options);\n    const nodeHandler = NodeHandler(options, wrapper);\n    const elementRegistry = ElementRegistry(options, elementStore, onClick);\n\n    function handleNodes(nodes: Array<Text | Attr>) {\n      for (const textNode of nodes) {\n        const parent = textNode.parentElement;\n\n        if (parent && elementRegistry.isRestricted(parent)) {\n          continue;\n        }\n\n        const oldTextContent = getNodeText(textNode);\n\n        const result = oldTextContent ? wrapper.unwrap(oldTextContent) : null;\n        if (result) {\n          const { text, keys } = result;\n          setNodeText(textNode, text);\n          const nodeMeta = initNodeMeta(oldTextContent!, keys);\n          const parentElement = domHelper.getSuitableParent(textNode);\n          elementRegistry.register(parentElement, textNode, nodeMeta);\n        }\n      }\n    }\n\n    function handleKeyAttributeAttr(attr: Attr) {\n      const parentElement = domHelper.getSuitableParent(attr);\n      elementRegistry.register(parentElement, attr, {\n        oldTextContent: '',\n        keys: [{ key: getNodeText(attr)! }],\n        keyAttributeOnly: true,\n      });\n    }\n\n    function handleKeyAttribute(node: Node, includeChild: boolean) {\n      if (node.nodeType === Node.ATTRIBUTE_NODE) {\n        const attr = node as Attr;\n        if (attr.name === TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE) {\n          handleKeyAttributeAttr(attr);\n          return;\n        }\n      }\n\n      if (node.nodeType === Node.ELEMENT_NODE) {\n        const element = node as Element;\n        const attr = element.getAttributeNode(\n          TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE\n        ) as Attr;\n        if (attr) {\n          handleKeyAttributeAttr(attr);\n        }\n      }\n\n      if (!includeChild) {\n        return;\n      }\n\n      const walker = document.createTreeWalker(\n        node,\n        NodeFilter.SHOW_ELEMENT,\n        (e) =>\n          (e as Element).hasAttribute(TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE)\n            ? NodeFilter.FILTER_ACCEPT\n            : NodeFilter.FILTER_SKIP\n      );\n      while (walker.nextNode()) {\n        const attr = (walker.currentNode as Element).getAttributeNode(\n          TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE\n        ) as Node;\n        handleKeyAttributeAttr(attr as Attr);\n      }\n    }\n\n    const observer = new MutationObserver((mutationsList: MutationRecord[]) => {\n      if (!isObserving) {\n        return;\n      }\n\n      const removedNodes = mutationsList\n        .filter((m) => m.type === 'childList')\n        .flatMap((m) => Array.from(m.removedNodes));\n      const removedNodesSet = new Set(removedNodes);\n\n      for (const node of removedNodes) {\n        if (node.nodeType === Node.ELEMENT_NODE) {\n          for (let i = 0; i < (node as Element).attributes.length; i++) {\n            removedNodesSet.add((node as Element).attributes[i]);\n          }\n        }\n\n        const treeWalker = document.createTreeWalker(\n          node,\n          NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_TEXT\n        );\n        while (treeWalker.nextNode()) {\n          const currentNode = treeWalker.currentNode;\n          if (currentNode.nodeType === Node.ELEMENT_NODE) {\n            const element = currentNode as Element;\n            for (let i = 0; i < element.attributes.length; i++) {\n              removedNodesSet.add(element.attributes[i]);\n            }\n          }\n          removedNodesSet.add(currentNode);\n        }\n      }\n\n      if (removedNodesSet.size > 0) {\n        elementRegistry.cleanupRemovedNodes(removedNodesSet);\n      }\n\n      if (\n        mutationsList.some(\n          (m) =>\n            m.type === 'attributes' &&\n            m.attributeName === TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE\n        )\n      ) {\n        elementRegistry.cleanupLingeringKeyAttributes();\n      }\n\n      const result: Set<Attr | Text> = new Set();\n      for (const mutation of mutationsList) {\n        switch (mutation.type) {\n          case 'characterData':\n            nodeHandler\n              .handleText(mutation.target)\n              .forEach((t) => result.add(t));\n            break;\n\n          case 'childList':\n            handleKeyAttribute(mutation.target, true);\n            if (mutation.addedNodes.length > 0) {\n              nodeHandler\n                .handleChildList(Array.from(mutation.addedNodes))\n                .forEach((t) => result.add(t));\n            }\n            if (mutation.removedNodes.length > 0) {\n              nodeHandler\n                .handleChildList(Array.from(mutation.removedNodes))\n                .forEach((t) => result.delete(t));\n            }\n            break;\n\n          case 'attributes':\n            if (mutation.attributeName === TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE) {\n              handleKeyAttribute(mutation.target, false);\n            }\n            nodeHandler\n              .handleAttributes(mutation.target, false)\n              .forEach((t) => result.add(t));\n            break;\n        }\n      }\n      handleNodes([...result]);\n    });\n\n    const targetElement = options.targetElement || document;\n    isObserving = true;\n    elementRegistry.run(mouseHighlight);\n\n    // initially go through all elements\n    handleKeyAttribute(targetElement, true);\n    handleNodes(nodeHandler.handleChildList([targetElement]));\n\n    const monitorAttributeList = new Set<string>();\n    monitorAttributeList.add(TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE);\n    Object.values(options.tagAttributes).forEach((attrs) =>\n      attrs.forEach((attr) => monitorAttributeList.add(attr.toLowerCase()))\n    );\n\n    // then observe for changes\n    observer.observe(targetElement, {\n      attributes: true,\n      attributeFilter: [...monitorAttributeList],\n      childList: true,\n      subtree: true,\n      characterData: true,\n    });\n\n    return {\n      stop() {\n        isObserving = false;\n        elementRegistry.stop();\n        observer.disconnect();\n      },\n      elementRegistry,\n      wrapper,\n    };\n  }\n\n  const self = Object.freeze({\n    run(props: RunProps) {\n      instance = createRunningInstance(props);\n    },\n\n    stop() {\n      instance?.stop();\n    },\n\n    forEachElement(callback: (el: TolgeeElement, meta: ElementMeta) => void) {\n      instance?.elementRegistry?.forEachElement?.(callback);\n    },\n\n    highlight(key?: string, ns?: NsFallback) {\n      const elements = instance?.elementRegistry?.findAll(key, ns) || [];\n      elements.forEach((el) => el.highlight?.());\n      return {\n        unhighlight() {\n          elements.forEach((el) => el.unhighlight?.());\n        },\n      };\n    },\n\n    findPositions(key?: string, ns?: NsFallback) {\n      const elements = instance?.elementRegistry?.findAll(key, ns) || [];\n      const result: KeyPosition[] = [];\n      // sort elements by their position in the dom\n      elements.sort((a, b) => {\n        if (\n          a.element.compareDocumentPosition(b.element) &\n          Node.DOCUMENT_POSITION_FOLLOWING\n        ) {\n          return -1;\n        } else {\n          return 1;\n        }\n      });\n      elements.forEach((meta) => {\n        const shape = meta.element.getBoundingClientRect();\n        meta.nodes.forEach((node) => {\n          node.keys.forEach((val) => {\n            if (\n              compareDescriptors(\n                { key, ns: getFallback(ns) },\n                { key: val.key, ns: getFallback(val.ns) }\n              )\n            )\n              result.push({\n                position: {\n                  x: shape.x,\n                  y: shape.y,\n                  width: shape.width,\n                  height: shape.height,\n                },\n                keyName: val.key,\n                keyNamespace: val.ns || '',\n              });\n          });\n        });\n      });\n      return result;\n    },\n\n    unwrap(text: string): Unwrapped {\n      if (instance) {\n        return instance.wrapper.unwrap(text);\n      }\n      return {\n        text,\n        keys: [],\n      };\n    },\n\n    wrap(props: WrapperWrapProps): string {\n      if (instance) {\n        return instance.wrapper.wrap(props);\n      }\n      return props.translation || '';\n    },\n  });\n\n  return self;\n}\n\nexport type GeneralObserverType = ReturnType<typeof GeneralObserver>;\n","import { TolgeeElement, ElementMeta } from '../../types';\n\nexport type RegistredElementsMap = Map<TolgeeElement, ElementMeta>;\n\nexport function ElementStore() {\n  const registredElements: RegistredElementsMap = new Map();\n\n  return Object.freeze({\n    set(el: TolgeeElement, meta: ElementMeta) {\n      registredElements.set(el, meta);\n    },\n\n    get(el: TolgeeElement | undefined) {\n      return el && registredElements.get(el);\n    },\n\n    remove(el: TolgeeElement) {\n      return registredElements.delete(el);\n    },\n\n    forEachElement(callback: (el: TolgeeElement, meta: ElementMeta) => void) {\n      registredElements.forEach((value, key) => callback(key, value));\n    },\n  });\n}\n\nexport type ElementStoreType = ReturnType<typeof ElementStore>;\n","import { ObserverOptions } from '@tolgee/core';\n\nexport function DomHelper(options: ObserverOptions) {\n  function getParentElement(node: Node): Element | undefined {\n    if (node.parentElement) {\n      return node.parentElement;\n    }\n    if ((node as Attr).ownerElement) {\n      return (node as Attr).ownerElement || undefined;\n    }\n  }\n\n  const self = Object.freeze({\n    getSuitableParent(node: Node): Element {\n      const domParent = getParentElement(node);\n\n      if (domParent === undefined) {\n        // eslint-disable-next-line no-console\n        console.error(node);\n        throw new Error('No suitable parent found for node above.');\n      }\n\n      if (!options.passToParent) {\n        return domParent;\n      }\n\n      if (Array.isArray(options.passToParent)) {\n        const tagNameEquals = (elementTagName: string) =>\n          domParent.tagName.toLowerCase() === elementTagName.toLowerCase();\n        if (options.passToParent.findIndex(tagNameEquals) === -1) {\n          return domParent;\n        }\n      }\n\n      if (typeof options.passToParent === 'function') {\n        if (!options.passToParent(domParent)) {\n          return domParent;\n        }\n      }\n\n      return self.getSuitableParent(domParent);\n    },\n  });\n\n  return self;\n}\n","import { ObserverOptionsInternal, WrapperMiddleware } from '@tolgee/core';\n\nexport function NodeHandler(\n  options: ObserverOptionsInternal,\n  wrapper: WrapperMiddleware\n) {\n  const self = Object.freeze({\n    handleAttributes(node: Node, includeChild = true) {\n      const result: Attr[] = [];\n\n      const tagAttributes = Object.fromEntries(\n        Object.entries(options.tagAttributes).map(([tag, attributes]) => [\n          tag.toUpperCase(),\n          attributes,\n        ])\n      ) as Record<string, string[]>;\n\n      if (node.nodeType === Node.ELEMENT_NODE) {\n        const element = node as Element;\n        let attributes = tagAttributes[element.tagName.toUpperCase()] ?? [];\n        if ('*' in tagAttributes) {\n          attributes = attributes.concat(tagAttributes['*']);\n        }\n        result.push(\n          ...(attributes\n            .filter((attrName) => element.hasAttribute(attrName))\n            .map((attrName) => element.getAttributeNode(attrName))\n            .filter((attrNode) =>\n              wrapper.testAttribute(attrNode as Attr)\n            ) as Attr[])\n        );\n      }\n\n      if (includeChild) {\n        const walker = document.createTreeWalker(\n          node,\n          NodeFilter.SHOW_ELEMENT,\n          (f) =>\n            tagAttributes[(f as Element).tagName.toUpperCase()]?.some((t) =>\n              (f as Element).hasAttribute(t)\n            ) || tagAttributes['*']?.some((t) => (f as Element).hasAttribute(t))\n              ? NodeFilter.FILTER_ACCEPT\n              : NodeFilter.FILTER_SKIP\n        );\n        while (walker.nextNode()) {\n          const element = walker.currentNode as Element;\n          let attributes = tagAttributes[element.tagName.toUpperCase()] ?? [];\n          if ('*' in tagAttributes) {\n            attributes = attributes.concat(tagAttributes['*']);\n          }\n          result.push(\n            ...(attributes\n              .filter((attrName) => element.hasAttribute(attrName))\n              .map((attrName) => element.getAttributeNode(attrName))\n              .filter((attrNode) =>\n                wrapper.testAttribute(attrNode as Attr)\n              ) as Attr[])\n          );\n        }\n      }\n\n      return result;\n    },\n\n    handleChildList(node: Node[]) {\n      const result: (Attr | Text)[] = [];\n      result.push(...node.flatMap((n) => self.handleAttributes(n, true)));\n      result.push(...node.flatMap((n) => self.handleText(n)));\n      // wrappedHandler(node);\n      return result;\n    },\n\n    handleText(node: Node) {\n      if (node.nodeType === Node.TEXT_NODE) {\n        return wrapper.testTextNode(node as Text) ? [node as Text] : [];\n      }\n\n      const nodes = [];\n\n      const walker = document.createTreeWalker(\n        node,\n        NodeFilter.SHOW_TEXT,\n        (f) =>\n          wrapper.testTextNode(f as Text)\n            ? NodeFilter.FILTER_ACCEPT\n            : NodeFilter.FILTER_SKIP\n      );\n      while (walker.nextNode()) {\n        nodes.push(walker.currentNode);\n      }\n\n      return nodes as Text[];\n    },\n  });\n\n  return self;\n}\n\nexport type NodeHandlerInstance = ReturnType<typeof NodeHandler>;\n","(function(scope) {'use strict';\nfunction B(r,e){var f;return r instanceof Buffer?f=r:f=Buffer.from(r.buffer,r.byteOffset,r.byteLength),f.toString(e)}var w=function(r){return Buffer.from(r)};function h(r){for(var e=0,f=Math.min(256*256,r.length+1),n=new Uint16Array(f),i=[],o=0;;){var t=e<r.length;if(!t||o>=f-1){var s=n.subarray(0,o),m=s;if(i.push(String.fromCharCode.apply(null,m)),!t)return i.join(\"\");r=r.subarray(e),e=0,o=0}var a=r[e++];if((a&128)===0)n[o++]=a;else if((a&224)===192){var d=r[e++]&63;n[o++]=(a&31)<<6|d}else if((a&240)===224){var d=r[e++]&63,l=r[e++]&63;n[o++]=(a&31)<<12|d<<6|l}else if((a&248)===240){var d=r[e++]&63,l=r[e++]&63,R=r[e++]&63,c=(a&7)<<18|d<<12|l<<6|R;c>65535&&(c-=65536,n[o++]=c>>>10&1023|55296,c=56320|c&1023),n[o++]=c}}}function F(r){for(var e=0,f=r.length,n=0,i=Math.max(32,f+(f>>>1)+7),o=new Uint8Array(i>>>3<<3);e<f;){var t=r.charCodeAt(e++);if(t>=55296&&t<=56319){if(e<f){var s=r.charCodeAt(e);(s&64512)===56320&&(++e,t=((t&1023)<<10)+(s&1023)+65536)}if(t>=55296&&t<=56319)continue}if(n+4>o.length){i+=8,i*=1+e/r.length*2,i=i>>>3<<3;var m=new Uint8Array(i);m.set(o),o=m}if((t&4294967168)===0){o[n++]=t;continue}else if((t&4294965248)===0)o[n++]=t>>>6&31|192;else if((t&4294901760)===0)o[n++]=t>>>12&15|224,o[n++]=t>>>6&63|128;else if((t&4292870144)===0)o[n++]=t>>>18&7|240,o[n++]=t>>>12&63|128,o[n++]=t>>>6&63|128;else continue;o[n++]=t&63|128}return o.slice?o.slice(0,n):o.subarray(0,n)}var u=\"Failed to \",p=function(r,e,f){if(r)throw new Error(\"\".concat(u).concat(e,\": the '\").concat(f,\"' option is unsupported.\"))};var x=typeof Buffer==\"function\"&&Buffer.from;var A=x?w:F;function v(){this.encoding=\"utf-8\"}v.prototype.encode=function(r,e){return p(e&&e.stream,\"encode\",\"stream\"),A(r)};function U(r){var e;try{var f=new Blob([r],{type:\"text/plain;charset=UTF-8\"});e=URL.createObjectURL(f);var n=new XMLHttpRequest;return n.open(\"GET\",e,!1),n.send(),n.responseText}finally{e&&URL.revokeObjectURL(e)}}var O=!x&&typeof Blob==\"function\"&&typeof URL==\"function\"&&typeof URL.createObjectURL==\"function\",S=[\"utf-8\",\"utf8\",\"unicode-1-1-utf-8\"],T=h;x?T=B:O&&(T=function(r){try{return U(r)}catch(e){return h(r)}});var y=\"construct 'TextDecoder'\",E=\"\".concat(u,\" \").concat(y,\": the \");function g(r,e){p(e&&e.fatal,y,\"fatal\"),r=r||\"utf-8\";var f;if(x?f=Buffer.isEncoding(r):f=S.indexOf(r.toLowerCase())!==-1,!f)throw new RangeError(\"\".concat(E,\" encoding label provided ('\").concat(r,\"') is invalid.\"));this.encoding=r,this.fatal=!1,this.ignoreBOM=!1}g.prototype.decode=function(r,e){p(e&&e.stream,\"decode\",\"stream\");var f;return r instanceof Uint8Array?f=r:r.buffer instanceof ArrayBuffer?f=new Uint8Array(r.buffer):f=new Uint8Array(r),T(f,this.encoding)};scope.TextEncoder=scope.TextEncoder||v;scope.TextDecoder=scope.TextDecoder||g;\n}(typeof window !== 'undefined' ? window : (typeof global !== 'undefined' ? global : this)));\n","// @ts-ignore\nimport * as FastTextEncoding from 'fast-text-encoding';\n// make sure it's not treeshaken\n// eslint-disable-next-line no-console\nconsole.assert?.(FastTextEncoding);\n\nexport const INVISIBLE_CHARACTERS = ['\\u200C', '\\u200D'];\n\nexport const INVISIBLE_REGEX = RegExp(\n  `([${INVISIBLE_CHARACTERS.join('')}]{9})+`,\n  'gu'\n);\n\nfunction toBytes(text: string) {\n  return Array.from(new TextEncoder().encode(text));\n}\n\nfunction fromBytes(bytes: Iterable<number>) {\n  return new TextDecoder().decode(new Uint8Array(bytes));\n}\n\nfunction padToWholeBytes(binary: string) {\n  const needsToAdd = 8 - binary.length;\n  return '0'.repeat(needsToAdd) + binary;\n}\n\nexport function encodeMessage(text: string) {\n  const bytes = toBytes(text).map(Number);\n  const binary = bytes\n    .map((byte) => padToWholeBytes(byte.toString(2)) + '0')\n    .join('');\n\n  const result = Array.from(binary)\n    .map((b) => INVISIBLE_CHARACTERS[Number(b)])\n    .join('');\n\n  return result;\n}\n\nfunction decodeMessage(message: string) {\n  const binary = Array.from(message)\n    .map((character) => {\n      return INVISIBLE_CHARACTERS.indexOf(character);\n    })\n    .map(String)\n    .join('');\n\n  const textBytes = binary.match(/(.{9})/g);\n  const codes = Uint8Array.from(\n    textBytes?.map((byte) => parseInt(byte.slice(0, 8), 2)) || []\n  );\n  return fromBytes(codes);\n}\n\nexport function decodeFromText(text: string) {\n  const invisibleMessages = text\n    .match(INVISIBLE_REGEX)\n    ?.filter((m) => m.length > 8);\n  return invisibleMessages?.map(decodeMessage) || [];\n}\n\nexport function removeSecrets(text: string) {\n  return text.replace(INVISIBLE_REGEX, '');\n}\n","import type {\n  KeyAndParams,\n  Unwrapped,\n  WrapperMiddleware,\n  TranslatePropsInternal,\n} from '@tolgee/core';\n\nimport {\n  decodeFromText,\n  encodeMessage,\n  INVISIBLE_CHARACTERS,\n  removeSecrets,\n} from './secret';\nimport { ValueMemory } from './ValueMemory';\n\n/**\n * LF character to separate messages (when they are right next to each other)\n *\n * We can use the fact that `\\n` characters get escaped inside the JSON strings and we don't need them with numbers\n * so we can safely use newlines to separate strings\n *\n * WARNING: don't encode formatted json like this (because then there are newlines):\n * {\n *   \"a\": \"b\"\n * }\n * this is correct:\n * {\"a\":\"b\"}\n */\nexport const MESSAGE_END = '\\x0A';\n\ntype EncodeValue = {\n  // key\n  k: string;\n  // namespaces\n  n: string | undefined;\n  // default value\n  d: string | undefined;\n};\n\ntype Props = {\n  fullKeyEncode: boolean;\n};\n\nexport function InvisibleWrapper({ fullKeyEncode }: Props): WrapperMiddleware {\n  const keyMemory = ValueMemory();\n\n  function encodeValue(data: TranslatePropsInternal) {\n    const value: EncodeValue = {\n      k: data.key,\n      n: data.ns || undefined,\n      d: data.defaultValue,\n    };\n    return JSON.stringify(value);\n  }\n\n  function decodeValue(value: string): EncodeValue | undefined {\n    try {\n      return JSON.parse(value || '{}') as EncodeValue;\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.error(e);\n      return undefined;\n    }\n  }\n\n  function retrieveMessages(text: string) {\n    return text\n      .split(MESSAGE_END)\n      .filter((m) => m.length)\n      .map((message) => {\n        if (message[0] === '{') {\n          // there is a json inside - the full key is included, not just number `fullKeyEncode`\n          return message;\n        } else {\n          const valueCode = Number(message);\n          return keyMemory.numberToValue(valueCode);\n        }\n      });\n  }\n\n  function encodeWithSeparator(message: string) {\n    return encodeMessage(message + MESSAGE_END);\n  }\n\n  return Object.freeze({\n    unwrap(text: string): Unwrapped {\n      const keysAndParams = [] as KeyAndParams[];\n      const texts = decodeFromText(text);\n      texts.forEach((encodedValue: string) => {\n        const messages = retrieveMessages(encodedValue);\n        messages.forEach((message) => {\n          const decodedVal = decodeValue(message);\n          if (decodedVal) {\n            const { k: key, d: defaultValue, n: ns } = decodedVal;\n            keysAndParams.push({\n              key,\n              defaultValue,\n              ns,\n            });\n          }\n        });\n      });\n\n      const result = removeSecrets(text);\n\n      return { text: result, keys: keysAndParams };\n    },\n\n    wrap({ key, defaultValue, translation, ns }) {\n      let invisibleMark: string;\n      if (fullKeyEncode) {\n        // don't include default value, as that might be very long when encoded\n        const encodedValue = encodeValue({ key, ns });\n        invisibleMark = encodeWithSeparator(encodedValue);\n      } else {\n        const encodedValue = encodeValue({ key, ns, defaultValue });\n        const code = keyMemory.valueToNumber(encodedValue);\n        invisibleMark = encodeWithSeparator(String(code));\n      }\n\n      const value = translation || '';\n\n      return typeof value === 'string' ? value + invisibleMark : value;\n    },\n\n    testTextNode(textNode: Text) {\n      return (\n        (textNode.textContent?.includes(\n          `${INVISIBLE_CHARACTERS[0]}${INVISIBLE_CHARACTERS[0]}`\n        ) ||\n          textNode.textContent?.includes(\n            `${INVISIBLE_CHARACTERS[1]}${INVISIBLE_CHARACTERS[0]}`\n          )) ??\n        false\n      );\n    },\n\n    testAttribute(attribute: Attr) {\n      return (\n        attribute.value.includes(\n          `${INVISIBLE_CHARACTERS[0]}${INVISIBLE_CHARACTERS[0]}`\n        ) ||\n        attribute.value.includes(\n          `${INVISIBLE_CHARACTERS[1]}${INVISIBLE_CHARACTERS[0]}`\n        )\n      );\n    },\n  });\n}\n","export function ValueMemory() {\n  const values: string[] = [];\n\n  return Object.freeze({\n    valueToNumber(key: string) {\n      let index = values.indexOf(key);\n      if (index === -1) {\n        index = values.length;\n        values.push(key);\n      }\n      return index;\n    },\n\n    numberToValue(num: number) {\n      return values[num];\n    },\n  });\n}\n\nexport type ValueMemoryInstance = ReturnType<typeof ValueMemory>;\n","export function splitOnNonEscapedDelimiter(\n  string: string,\n  delimiter: string\n): string[] {\n  const result = [];\n  let actual = '';\n  let escaped = false;\n  for (let i = 0; i < string.length; i++) {\n    const char = string[i];\n    if (char === '\\\\' && !escaped) {\n      escaped = true;\n      continue;\n    }\n    if (escaped) {\n      escaped = false;\n      actual += char;\n      continue;\n    }\n    if (char === delimiter) {\n      result.push(actual);\n      actual = '';\n      continue;\n    }\n    actual += char;\n  }\n  result.push(actual);\n  return result;\n}\n\nexport function isCharEscaped(position: number, fullString: string) {\n  let escapeCharsCount = 0;\n  while (position > -1 && fullString[position - 1] === '\\\\') {\n    escapeCharsCount++;\n    position--;\n  }\n  return escapeCharsCount % 2 == 1;\n}\n\nexport function removeEscapes(string: string) {\n  let result = '';\n  let escaped = false;\n  for (let i = 0; i < string.length; i++) {\n    const char = string[i];\n    if (char === '\\\\' && !escaped) {\n      escaped = true;\n      continue;\n    }\n    if (escaped) {\n      escaped = false;\n      result += char;\n      continue;\n    }\n    result += char;\n  }\n  return result;\n}\n","import type {\n  KeyAndParams,\n  TranslatePropsInternal,\n  WrapperMiddleware,\n} from '@tolgee/core';\nimport { isCharEscaped } from './helpers';\n\ntype Props = {\n  inputPrefix: string;\n  inputSuffix: string;\n  translate: (params: TranslatePropsInternal) => string;\n};\n\nexport function TextWrapper({\n  inputPrefix,\n  inputSuffix,\n  translate,\n}: Props): WrapperMiddleware {\n  function getRawUnWrapRegex(): string {\n    const escapedPrefix = escapeForRegExp(inputPrefix);\n    const escapedSuffix = escapeForRegExp(inputSuffix);\n    return `(\\\\\\\\?)(${escapedPrefix}(.*?)${escapedSuffix})`;\n  }\n\n  function parseUnwrapped(unwrappedString: string): KeyAndParams {\n    let escaped = false;\n    let actual = '';\n    let paramName = '';\n    let readingState:\n      | 'KEY'\n      | 'DEFAULT_VALUE'\n      | 'PARAM_NAME'\n      | 'PARAM_VALUE'\n      | 'NAMESPACE' = 'KEY';\n\n    const result = {\n      key: '',\n      ns: undefined as string | undefined,\n      params: {},\n      defaultValue: undefined as string | undefined,\n    } as KeyAndParams;\n\n    const addNamespace = (ns: string) => {\n      result.ns = ns;\n    };\n\n    for (const char of unwrappedString) {\n      if (char === '\\\\' && !escaped) {\n        escaped = true;\n        continue;\n      }\n      if (escaped) {\n        escaped = false;\n        actual += char;\n        continue;\n      }\n      if (readingState === 'KEY' && char === ',') {\n        readingState = 'DEFAULT_VALUE';\n        result.key = actual;\n        actual = '';\n        continue;\n      }\n      if (readingState === 'KEY' && char === '|') {\n        readingState = 'NAMESPACE';\n        result.key = actual;\n        actual = '';\n        continue;\n      }\n      if (readingState === 'NAMESPACE' && char === ',') {\n        readingState = 'DEFAULT_VALUE';\n        addNamespace(actual);\n        actual = '';\n        continue;\n      }\n      if (readingState === 'KEY' && char === ':') {\n        readingState = 'PARAM_NAME';\n        result.key = actual;\n        actual = '';\n        continue;\n      }\n\n      if (readingState === 'DEFAULT_VALUE' && char === ':') {\n        readingState = 'PARAM_NAME';\n        result.defaultValue = actual;\n        actual = '';\n        continue;\n      }\n\n      if (readingState === 'PARAM_NAME' && char === ':') {\n        readingState = 'PARAM_VALUE';\n        paramName = actual;\n        actual = '';\n        continue;\n      }\n\n      if (readingState === 'PARAM_VALUE' && char === ',') {\n        readingState = 'PARAM_NAME';\n        result.params![paramName] = actual;\n        actual = '';\n        continue;\n      }\n      actual += char;\n    }\n\n    if (readingState === 'KEY') {\n      result.key = actual;\n    }\n\n    if (readingState === 'DEFAULT_VALUE') {\n      result.defaultValue = actual;\n    }\n\n    if (readingState === 'PARAM_VALUE') {\n      result.params![paramName] = actual;\n    }\n\n    if (readingState === 'NAMESPACE') {\n      addNamespace(actual);\n    }\n\n    return result;\n  }\n\n  function getTranslatedWithMetadata(text: string) {\n    const { key, params, defaultValue, ns } = parseUnwrapped(text);\n    const translated = translate({\n      key,\n      params,\n      defaultValue,\n      ns,\n      noWrap: true,\n    });\n    return { translated, key, params, defaultValue, ns };\n  }\n\n  function escapeForRegExp(string: string) {\n    return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  }\n\n  function escapeParam(param: any) {\n    if (typeof param === 'string') {\n      return param.replace(/[,:|\\\\]/gs, '\\\\$&');\n    }\n    if (typeof param === 'number' || typeof param === 'bigint') {\n      return param.toString();\n    }\n    // eslint-disable-next-line no-console\n    console.warn(\n      `Parameters of type \"${typeof param}\" are not supported in \"text\" wrapper mode.`\n    );\n    return param;\n  }\n\n  return Object.freeze({\n    wrap({ key, params, defaultValue, ns }): string {\n      let paramString = Object.entries(params || {})\n        .map(\n          ([name, value]) =>\n            `${escapeParam(name)}:${escapeParam(value as string)}`\n        )\n        .join(',');\n      paramString = paramString.length ? `:${paramString}` : '';\n\n      const defaultString =\n        defaultValue !== undefined ? `,${escapeParam(defaultValue)}` : '';\n\n      const nsArray = typeof ns === 'string' ? [ns] : ns;\n\n      const namespaces = nsArray?.length\n        ? `|${nsArray.map((ns) => escapeParam(ns)).join('|')}`\n        : '';\n\n      return `${inputPrefix}${escapeParam(\n        key\n      )}${namespaces}${defaultString}${paramString}${inputSuffix}`;\n    },\n\n    unwrap(text: string) {\n      const matchRegexp = new RegExp(getRawUnWrapRegex(), 'gs');\n\n      const keysAndParams: KeyAndParams[] = [];\n\n      let matched = false;\n\n      let match;\n      let start = 0;\n      let result = '';\n      while ((match = matchRegexp.exec(text)) !== null) {\n        let pre = match[1] as string;\n        const [fullMatch, _, wrapped, unwrapped] = match as unknown as [\n          string,\n          string,\n          string,\n          string,\n        ];\n        const { index, input } = match;\n        result += input.substr(start, index - start);\n        start = index + fullMatch.length;\n        if (pre === '\\\\') {\n          if (!isCharEscaped(index, text)) {\n            result += wrapped;\n            continue;\n          }\n          pre = '';\n        }\n        const translated = getTranslatedWithMetadata(unwrapped);\n        keysAndParams.push({\n          key: translated.key,\n          params: translated.params,\n          defaultValue: translated.defaultValue,\n          ns: translated.ns,\n        });\n        matched = true;\n        result += pre + translated.translated;\n      }\n\n      result += text.substring(start);\n\n      if (matched) {\n        return { text: result, keys: keysAndParams };\n      }\n\n      return { text: text, keys: [] };\n    },\n\n    testTextNode(textNode: Text) {\n      return (\n        (textNode.textContent?.includes(inputPrefix) &&\n          textNode.textContent?.includes(inputSuffix)) ??\n        false\n      );\n    },\n\n    testAttribute(attribute: Attr) {\n      return (\n        attribute.value.includes(inputPrefix) &&\n        attribute.value.includes(inputSuffix)\n      );\n    },\n  });\n}\n","import type { ObserverMiddleware, ObserverRunProps } from '@tolgee/core';\nimport { GeneralObserver } from './observers/general/GeneralObserver';\nimport { setNodeText } from './observers/general/helpers';\nimport { TextWrapper } from './observers/text/TextWrapper';\n\nexport const TextObserver = (): ObserverMiddleware => () => {\n  const observer = GeneralObserver();\n\n  const self = Object.freeze({\n    ...observer,\n\n    run(props: ObserverRunProps) {\n      const wrapper = TextWrapper({\n        inputPrefix: props.options.inputPrefix,\n        inputSuffix: props.options.inputSuffix,\n        translate: props.translate,\n      });\n      observer.run({ ...props, wrapper });\n    },\n\n    retranslate() {\n      observer.forEachElement((_, elMeta) => {\n        for (const [node, nodeMeta] of elMeta.nodes.entries()) {\n          if (nodeMeta.keyAttributeOnly) {\n            return;\n          }\n          const result = observer.unwrap(nodeMeta.oldTextContent);\n          if (result) {\n            setNodeText(node, result.text);\n          }\n        }\n      });\n    },\n\n    outputNotFormattable: true,\n  });\n  return self;\n};\n","import { TolgeePlugin } from '@tolgee/core';\nimport { InvisibleObserver } from './InvisibleObserver';\nimport { TextObserver } from './TextObserver';\n\nexport const ObserverPlugin = (): TolgeePlugin => (tolgee, tools) => {\n  if (tolgee.getInitialOptions().observerType === 'text') {\n    tools.setObserver(TextObserver());\n  } else {\n    tools.setObserver(InvisibleObserver());\n  }\n  return tolgee;\n};\n","import type { ObserverMiddleware, ObserverRunProps } from '@tolgee/core';\nimport { GeneralObserver } from './observers/general/GeneralObserver';\nimport { InvisibleWrapper } from './observers/invisible/InvisibleWrapper';\n\nexport const InvisibleObserver = (): ObserverMiddleware => () => {\n  const observer = GeneralObserver();\n\n  const self = Object.freeze({\n    ...observer,\n    run(props: ObserverRunProps) {\n      const wrapper = InvisibleWrapper({\n        fullKeyEncode: props.options.fullKeyEncode,\n      });\n      observer.run({ ...props, wrapper });\n    },\n    retranslate() {},\n    outputNotFormattable: false,\n  });\n  return self;\n};\n","const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';\n\nfunction readChar(char: string) {\n  const idx = alphabet.indexOf(char);\n\n  if (idx === -1) {\n    throw new Error('Invalid character found: ' + char);\n  }\n\n  return idx;\n}\n\nfunction arrayBufferToString(buffer: any) {\n  const bufView = new Uint8Array(buffer);\n  const length = bufView.length;\n  let result = '';\n  let addition = Math.pow(2, 16) - 1;\n\n  for (let i = 0; i < length; i += addition) {\n    if (i + addition > length) {\n      addition = length - i;\n    }\n    result += String.fromCharCode.apply(\n      null,\n      // @ts-ignore\n      bufView.subarray(i, i + addition)\n    );\n  }\n\n  return result;\n}\n\nfunction base32Decode(input: string) {\n  input = input.toUpperCase();\n\n  const length = input.length;\n\n  let bits = 0;\n  let value = 0;\n\n  let index = 0;\n  const output = new Uint8Array(((length * 5) / 8) | 0);\n\n  for (let i = 0; i < length; i++) {\n    value = (value << 5) | readChar(input[i]);\n    bits += 5;\n\n    if (bits >= 8) {\n      output[index++] = (value >>> (bits - 8)) & 255;\n      bits -= 8;\n    }\n  }\n\n  return arrayBufferToString(output.buffer);\n}\n\nexport function getProjectIdFromApiKey(\n  key: string | undefined\n): number | undefined {\n  if (!key) {\n    return undefined;\n  }\n  try {\n    const [prefix, rest] = key.split('_');\n    if (prefix === 'tgpak') {\n      const [projectId] = base32Decode(rest).split('_');\n      return Number(projectId);\n    }\n  } catch {\n    // eslint-disable-next-line no-console\n    console.warn(\"Tolgee: Api key can't be parsed\");\n  }\n  return undefined;\n}\n\nexport function getApiKeyType(key: string | undefined) {\n  if (!key) {\n    return undefined;\n  }\n  const [prefix] = key.split('_');\n  if (prefix === 'tgpak') {\n    return 'tgpak';\n  } else if (prefix === 'tgpat') {\n    return 'tgpat';\n  }\n\n  return 'legacy';\n}\n","function composeUrl(base: string, path: string): string {\n  // Ensure the base URL does not end with a slash\n  base = base.replace(/\\/+$/, '');\n  // Ensure the path does not start with a slash\n  path = path.replace(/^\\/+/, '');\n  // Combine the two parts with a single slash in between\n  return `${base}/${path}`;\n}\n\nexport function joinUrls(...parts: string[]): string {\n  let result = parts[0];\n  parts.slice(1).forEach((part) => {\n    result = composeUrl(result, part);\n  });\n  return result;\n}\n\nexport function createUrl(...parts: string[]): URL {\n  const base =\n    typeof window === 'undefined' ? undefined : window.location.origin;\n  return new URL(joinUrls(...parts), base);\n}\n","import { BackendDevMiddleware, TolgeePlugin } from '@tolgee/core';\nimport { getApiKeyType, getProjectIdFromApiKey } from './tools/decodeApiKey';\nimport { createUrl } from './tools/url';\n\nfunction createDevBackend(): BackendDevMiddleware {\n  return {\n    getRecord({\n      apiUrl,\n      apiKey,\n      language,\n      namespace,\n      projectId,\n      filterTag,\n      fetch,\n    }) {\n      const pId = getProjectIdFromApiKey(apiKey) ?? projectId;\n      let url: URL;\n      if (pId !== undefined) {\n        url = createUrl(apiUrl, `/v2/projects/${pId}/translations/${language}`);\n      } else {\n        url = createUrl(apiUrl, `/v2/projects/translations/${language}`);\n      }\n\n      if (namespace) {\n        url.searchParams.append('ns', namespace);\n      }\n      filterTag?.forEach((tag) => {\n        url.searchParams.append('filterTag', tag);\n      });\n\n      if (getApiKeyType(apiKey) === 'tgpat' && projectId === undefined) {\n        throw new Error(\"You need to specify 'projectId' when using PAT key\");\n      }\n\n      return fetch(url.toString(), {\n        headers: {\n          'X-API-Key': apiKey || '',\n          'Content-Type': 'application/json',\n        },\n        // @ts-ignore - tell next.js to not use cache\n        next: { revalidate: 0 },\n      }).then((r) => {\n        if (r.ok) {\n          return r.json().then((data) => data[language]);\n        } else {\n          throw new Error(r.statusText);\n        }\n      });\n    },\n  };\n}\n\nexport const DevBackend = (): TolgeePlugin => (tolgee, tools) => {\n  tools.setDevBackend(createDevBackend());\n  return tolgee;\n};\n","type Props = {\n  message: string;\n  recievingMessage: string[];\n  data?: any;\n  attempts?: number;\n  timeout?: number;\n};\n\nexport function listen<T = any>(type: string[], callback: (data?: T) => any) {\n  const handler = (e: MessageEvent) => {\n    if (type.includes(e.data?.type)) {\n      callback(e.data?.data);\n    }\n  };\n  window.addEventListener('message', handler, false);\n  return {\n    unsubscribe() {\n      window.removeEventListener('message', handler);\n    },\n  };\n}\n\nexport function sendAndRecieve<T>({\n  message,\n  recievingMessage,\n  data,\n  attempts = 1,\n  timeout = 300,\n}: Props) {\n  let cancelled = false;\n  const makeAttempt = () =>\n    new Promise<T>((resolve, reject) => {\n      const listener = listen(recievingMessage, handler);\n      window.postMessage({ type: message, data }, window.origin);\n      const timer = setTimeout(expire, timeout);\n\n      function handler(data: any) {\n        clearTimeout(timer);\n        removeEventListener();\n        resolve(data);\n      }\n      function removeEventListener() {\n        listener.unsubscribe();\n      }\n      function expire() {\n        removeEventListener();\n        reject();\n      }\n    });\n\n  const getData = async (): Promise<T> => {\n    for (let i = 0; i < attempts; i++) {\n      if (cancelled) {\n        return new Promise<T>(() => {});\n      }\n      try {\n        const result = await makeAttempt();\n        return result;\n      } catch (e) {\n        continue;\n      }\n    }\n    if (!cancelled) {\n      throw `Didn't recieve ${recievingMessage.join(' or ')} in time.`;\n    }\n    return new Promise<T>(() => {});\n  };\n\n  return {\n    cancel() {\n      cancelled = true;\n    },\n    promise: getData(),\n  };\n}\n\nexport function takeScreenshot(): Promise<string> {\n  return sendAndRecieve({\n    message: 'TOLGEE_TAKE_SCREENSHOT',\n    recievingMessage: ['TOLGEE_SCREENSHOT_TAKEN'],\n    timeout: 3000,\n  }).promise as Promise<string>;\n}\n\nexport async function detectExtension(): Promise<boolean> {\n  try {\n    await sendAndRecieve({\n      message: 'TOLGEE_PING',\n      recievingMessage: ['TOLGEE_PONG'],\n      attempts: 2,\n    }).promise;\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nexport type LibConfig = {\n  uiPresent: boolean;\n  uiVersion?: string;\n  mode: 'production' | 'development';\n  config: {\n    apiUrl: string;\n    apiKey: string;\n  };\n};\n\nexport function Handshaker() {\n  let cancelLast: undefined | (() => void) = undefined;\n  async function update(data: LibConfig): Promise<boolean> {\n    cancelLast?.();\n    const { cancel, promise } = sendAndRecieve<boolean>({\n      message: 'TOLGEE_READY',\n      recievingMessage: ['TOLGEE_PLUGIN_READY', 'TOLGEE_PLUGIN_UPDATED'],\n      data,\n      attempts: 4,\n    });\n    cancelLast = cancel;\n    return promise;\n  }\n  return {\n    update,\n  };\n}\n","import type { InContextTools } from '../InContextTools';\nimport {\n  IN_CONTEXT_FILE,\n  IN_CONTEXT_UMD_NAME,\n  IN_CONTEXT_EXPORT_NAME,\n} from './constants';\n\nconst CDN_URL = 'https://cdn.jsdelivr.net/npm';\n\nfunction injectScript(src: string) {\n  return new Promise<void>((resolve, reject) => {\n    const script = document.createElement('script');\n    script.src = src;\n    script.addEventListener('load', () => resolve());\n    script.addEventListener('error', (e) => reject(e.error));\n    document.head.appendChild(script);\n  });\n}\n\nlet injectPromise = null as any as Promise<typeof InContextTools>;\n\nexport function loadInContextLib(version: string) {\n  if (!injectPromise) {\n    injectPromise = injectScript(\n      `${CDN_URL}/@tolgee/web@${version}/dist/${IN_CONTEXT_FILE}`\n    ).then(() => {\n      // @ts-ignore\n      return window[IN_CONTEXT_UMD_NAME][IN_CONTEXT_EXPORT_NAME];\n    });\n  }\n  return injectPromise;\n}\n","export const IN_CONTEXT_FILE = 'tolgee-in-context-tools.umd.min.js';\nexport const IN_CONTEXT_UMD_NAME = '@tolgee/in-context-tools';\nexport const IN_CONTEXT_EXPORT_NAME = 'InContextTools';\n","import type { TolgeePlugin } from '@tolgee/core';\nimport { Handshaker } from '../tools/extension';\nimport { loadInContextLib } from './loadInContextLib';\n\nexport const API_KEY_LOCAL_STORAGE = '__tolgee_apiKey';\nexport const API_URL_LOCAL_STORAGE = '__tolgee_apiUrl';\n\nfunction getCredentials() {\n  const apiKey = sessionStorage.getItem(API_KEY_LOCAL_STORAGE) || undefined;\n  const apiUrl = sessionStorage.getItem(API_URL_LOCAL_STORAGE) || undefined;\n\n  if (!apiKey || !apiUrl) {\n    return undefined;\n  }\n\n  return {\n    apiKey,\n    apiUrl,\n  };\n}\n\nfunction clearSessionStorage() {\n  sessionStorage.removeItem(API_KEY_LOCAL_STORAGE);\n  sessionStorage.removeItem(API_URL_LOCAL_STORAGE);\n}\n\nfunction onDocumentReady(callback: () => void) {\n  // in case the document is already rendered\n  if (document.readyState !== 'loading') {\n    Promise.resolve().then(() => {\n      callback();\n    });\n  }\n  // modern browsers\n  else if (document.addEventListener) {\n    document.addEventListener('DOMContentLoaded', callback);\n  }\n}\n\nexport type BrowserExtensionProps = {\n  noReload?: boolean;\n};\n\nlet BrowserExtensionPlugin: () => TolgeePlugin = () => (tolgee) => tolgee;\n\nconst sessionStorageAvailable = () => {\n  if (typeof window === 'undefined') {\n    return false;\n  }\n  try {\n    return typeof sessionStorage !== 'undefined' && sessionStorage;\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error('sessionStorage not available', err);\n    return false;\n  }\n};\n\nif (sessionStorageAvailable()) {\n  BrowserExtensionPlugin = (): TolgeePlugin => (tolgee) => {\n    const handshaker = Handshaker();\n    const getConfig = () =>\n      ({\n        // prevent extension downloading ui library\n        uiPresent: true,\n        uiVersion: undefined,\n        // tolgee mode\n        mode: tolgee.isDev() ? 'development' : 'production',\n        // pass credentials\n        config: {\n          apiUrl: tolgee.getInitialOptions().apiUrl || '',\n          apiKey: tolgee.getInitialOptions().apiKey || '',\n        },\n      }) as const;\n\n    const getTolgeePlugin = async (): Promise<TolgeePlugin> => {\n      const InContextTools = await loadInContextLib(\n        process.env.TOLGEE_UI_VERSION || 'prerelease'\n      );\n      return (tolgee) => {\n        const credentials = getCredentials()!;\n        tolgee.addPlugin(InContextTools({ credentials }));\n        return tolgee;\n      };\n    };\n\n    tolgee.on('running', ({ value: isRunning }) => {\n      if (isRunning) {\n        onDocumentReady(() => {\n          handshaker.update(getConfig()).catch(clearSessionStorage);\n        });\n      }\n    });\n\n    const credentials = getCredentials();\n    if (credentials) {\n      getTolgeePlugin()\n        .then((plugin) => {\n          tolgee.addPlugin(plugin);\n        })\n        .catch((e) => {\n          // eslint-disable-next-line no-console\n          console.error('Tolgee: Failed to load in-context tools');\n          // eslint-disable-next-line no-console\n          console.error(e);\n        });\n    }\n\n    return tolgee;\n  };\n}\n\nexport { BrowserExtensionPlugin };\n","import type { LanguageStorageMiddleware, TolgeePlugin } from '@tolgee/core';\nimport { throwIfSSR } from './tools/isSSR';\n\nconst CURRENT_LANGUAGE_LOCAL_STORAGE_KEY = '__tolgee_currentLanguage';\n\nexport function createLanguageStorage(): LanguageStorageMiddleware {\n  return {\n    getLanguage() {\n      throwIfSSR('LanguageStorage');\n      const storedLanguage = localStorage.getItem(\n        CURRENT_LANGUAGE_LOCAL_STORAGE_KEY\n      );\n\n      return storedLanguage || undefined;\n    },\n\n    setLanguage(language: string) {\n      throwIfSSR('LanguageStorage');\n      localStorage.setItem(CURRENT_LANGUAGE_LOCAL_STORAGE_KEY, language);\n    },\n  };\n}\n\nexport const LanguageStorage = (): TolgeePlugin => (tolgee, tools) => {\n  tools.setLanguageStorage(createLanguageStorage());\n  return tolgee;\n};\n","import type { LanguageDetectorMiddleware, TolgeePlugin } from '@tolgee/core';\nimport { throwIfSSR } from './tools/isSSR';\n\nexport function detectLanguage(language: string, availableLanguages: string[]) {\n  const exactMatch = availableLanguages.find((l) => l === language);\n  if (exactMatch) {\n    return exactMatch;\n  }\n\n  const getTwoLetters = (fullTag: string) =>\n    fullTag.replace(/^(.+?)(-.*)?$/, '$1');\n\n  const preferredTwoLetter = getTwoLetters(language);\n  const twoLetterMatch = availableLanguages.find(\n    (l) => getTwoLetters(l) === preferredTwoLetter\n  );\n  if (twoLetterMatch) {\n    return twoLetterMatch;\n  }\n  return undefined;\n}\n\nexport function createLanguageDetector(): LanguageDetectorMiddleware {\n  return {\n    getLanguage({ availableLanguages }) {\n      throwIfSSR('LanguageDetector');\n      const preferred = window.navigator.language;\n      return detectLanguage(preferred, availableLanguages);\n    },\n  };\n}\n\nexport const LanguageDetector = (): TolgeePlugin => (tolgee, tools) => {\n  tools.setLanguageDetector(createLanguageDetector());\n  return tolgee;\n};\n","import { detectLanguage } from '../LanguageDetector';\nimport { getHeaderLanguages } from './getHeaderLanguages';\n\nexport const detectLanguageFromHeaders = (\n  headers: Headers,\n  availableLanguages: string[]\n) => {\n  const languages = getHeaderLanguages(headers);\n  return languages[0] && detectLanguage(languages[0], availableLanguages);\n};\n","export function getHeaderLanguages(headers: Headers) {\n  const acceptLanguageHeader = headers.get('Accept-Language');\n  if (!acceptLanguageHeader) {\n    return [];\n  }\n  // Split the header into locales based on commas\n  const locales = acceptLanguageHeader.split(',').map((locale) => {\n    // Remove whitespace and split by ';' to get only the locale part\n    const [localePart] = locale.trim().split(';');\n    return localePart;\n  });\n\n  // Filter out any empty strings and return the unique locales\n  return [...new Set(locales.filter((locale) => locale && locale !== '*'))];\n}\n","import type { BackendMiddleware, FetchFn, TolgeePlugin } from '@tolgee/core';\nimport { GetPath, BackendOptions } from './types';\n\nconst fetchWithTimeout = (\n  fetch: FetchFn,\n  url: string,\n  ms: number | undefined,\n  { signal, ...options }: RequestInit\n) => {\n  const controller = new AbortController();\n  return new Promise<Response>((_resolve, _reject) => {\n    const promise = fetch(url, { signal: controller.signal, ...options });\n    let done = false;\n    function resolve(data) {\n      !done && _resolve(data);\n      done = true;\n    }\n    function reject(data) {\n      !done && _reject(data);\n      done = true;\n    }\n    function rejectWithTimout() {\n      const error = new Error(`TIMEOUT: ${url}`);\n      controller.abort(error);\n      reject(error);\n    }\n    if (signal) {\n      signal.addEventListener('abort', rejectWithTimout);\n    }\n    if (ms !== undefined) {\n      const timeout = setTimeout(rejectWithTimout, ms);\n      promise.finally(() => clearTimeout(timeout));\n    }\n    promise.catch(reject).then(resolve);\n  });\n};\n\nfunction trimSlashes(path: string) {\n  if (path.endsWith('/')) {\n    return path.slice(0, -1);\n  }\n  return path;\n}\n\nconst defaultGetPath: GetPath = ({ namespace, language, prefix }) => {\n  if (namespace) {\n    return `${trimSlashes(prefix)}/${namespace}/${language}.json`;\n  } else {\n    return `${trimSlashes(prefix)}/${language}.json`;\n  }\n};\n\nfunction defaultGetData(r: Response) {\n  return r.json();\n}\n\nconst DEFAULT_OPTIONS = {\n  prefix: '/i18n',\n  getPath: defaultGetPath,\n  getData: defaultGetData,\n  headers: {\n    Accept: 'application/json',\n  },\n  timeout: undefined,\n  fallbackOnFail: false,\n};\n\nexport function createBackendFetch(\n  options?: Partial<BackendOptions>\n): BackendMiddleware {\n  const {\n    prefix,\n    getPath,\n    getData,\n    headers,\n    timeout,\n    fallbackOnFail,\n    ...fetchOptions\n  }: BackendOptions = {\n    ...DEFAULT_OPTIONS,\n    ...options,\n    headers: {\n      ...DEFAULT_OPTIONS.headers,\n      ...options?.headers,\n    },\n  };\n  return {\n    async getRecord({ namespace, language, fetch }) {\n      const path = getPath({\n        namespace,\n        language,\n        prefix,\n      });\n\n      try {\n        const r = await fetchWithTimeout(fetch, path, timeout, {\n          headers,\n          ...fetchOptions,\n        });\n        if (!r.ok) {\n          throw new Error(`${r.url} ${r.status}`);\n        }\n        return await getData(r);\n      } catch (e) {\n        if (fallbackOnFail) {\n          return undefined;\n        } else {\n          throw e;\n        }\n      }\n    },\n  };\n}\n\nexport const BackendFetch =\n  (options?: Partial<BackendOptions>): TolgeePlugin =>\n  (tolgee, tools) => {\n    tools.addBackend(createBackendFetch(options));\n    return tolgee;\n  };\n","import { TolgeeCore, TolgeeChainer } from '@tolgee/core';\nimport { BrowserExtensionPlugin } from './BrowserExtensionPlugin/BrowserExtensionPlugin';\n\nexport function Tolgee(): TolgeeChainer {\n  return TolgeeCore().use(BrowserExtensionPlugin());\n}\n","import { TolgeeInstance } from '@tolgee/core';\n\nexport const DevTools = () => (tolgee: TolgeeInstance) => tolgee;\nexport * from './typedIndex';\nexport {\n  PREFERRED_LANGUAGES_LOCAL_STORAGE_KEY,\n  DEVTOOLS_ID,\n} from './constants';\n"],"names":["isPromise","value","Boolean","then","valueOrPromise","callback","Promise","resolve","handleRegularOrAsyncErr","onError","createError","handle","e","error","emit","console","result","catch","missingOptionError","option","options","Array","isArray","map","val","lastPart","slice","join","getFallback","getFallbackArray","getFallbackFromStruct","language","fallbackLanguage","item","unique","arr","from","Set","sanitizeUrl","url","replace","defaultFetchFunction","input","fetch","createFetchFunction","fetchFn","init","headers","headersInit","Object","fromEntries","Headers","entries","assign","EventEmitter","isActive","handlers","freeze","listen","handler","handlerWrapper","push","unsubscribe","filter","i","data","forEach","EventEmitterSelective","getFallbackNs","getDefaultNs","listeners","partialListeners","queue","solveQueue","length","queueCopy","namespaces","ns","add","fallbackNamespaces","findIndex","has","fn","callHandlers","keys","delayed","setTimeout","delete","listenSome","subscribeNs","RecordFetchError","Error","constructor","descriptor","cause","isDev","namespace","super","this","name","LanguageDetectorError","message","LanguageStorageError","flattenTranslations","Map","key","set","flatValue","flatKey","decodeCacheKey","firstPart","rest","split","encodeCacheKey","Cache","events","backendGetRecord","backendGetDevRecord","withDefaultNs","isInitialLoading","fetchingObserver","loadingObserver","asyncRequests","cache","staticData","version","addRecordInternal","recordVersion","cacheKey","onCacheChange","async","fetchData","keyObject","warn","handleError","dataFromBackend","staticDataValue","fetchProd","self","addStaticData","existing","get","invalidate","clear","addRecord","exists","strict","record","getRecord","_a","getTranslation","getTranslationNs","languages","getTranslationFallback","changeTranslation","isFetching","size","find","includes","isLoading","loadRecords","descriptors","withPromises","existingPromise","new","promise","dataPromise","notify","results","all","promiseChanged","getAllRecords","entry","__rest","s","t","p","prototype","hasOwnProperty","call","indexOf","getOwnPropertySymbols","propertyIsEnumerable","DEFAULT_FORMAT_ERROR","defaultValues","defaultNs","observerOptions","tagAttributes","textarea","img","restrictedElements","highlightKeys","highlightColor","highlightWidth","inputPrefix","inputSuffix","passToParent","fullKeyEncode","observerType","onFormatError","apiUrl","onTranslationMissing","combineOptions","states","state","initState","previousState","initialOptions","activeNamespaces","pendingLanguage","isRunning","Plugins","getLanguage","getInitialOptions","getAvailableLanguages","getFallbackNamespaces","plugins","ui","instances","formatters","finalFormatter","observer","devBackend","backends","languageDetector","languageStorage","onClick","keysAndDefaults","target","withNs","defaultValue","translation","handleElementClick","findPositions","translate","props","formatTranslation","formatEnabled","getCommonProps","setObserver","hasObserver","addFormatter","formatter","setFinalFormatter","setUi","hasUi","setLanguageStorage","storage","setLanguageDetector","detector","addBackend","backend","setDevBackend","addPlugin","tolgeeInstance","plugin","run","_b","apiKey","projectId","tagNewKeys","filterTag","highlight","onPermanentChange","mouseHighlight","stop","getLanguageStorage","getInitialLanguage","availableLanguages","detectLanguage","setStoredLanguage","setLanguage","getDevBackend","getBackendRecord","getBackendDevRecord","getLanguageDetector","retranslate","unhighlight","unwrap","text","wrap","params","hasDevBackend","noWrap","orEmpty","formattableTranslation","translationMissingResult","isFormatEnabled","outputNotFormattable","format","errorMessage","formatErrorType","ValueObserver","initialValue","valueGetter","previousValue","getTranslateProps","keyOrProps","parseCombinedOptions","Controller","emitterActive","onPendingLanguageChange","onLanguageChange","onLoadingChange","onFetchingChange","onInitialLoaded","onRunningChange","onUpdate","setEmitterActive","active","on","event","Events","devCredentials","setRunning","setInitialLoading","getPendingLanguage","setPendingLanguage","addActiveNs","removeActiveNs","getRequiredNamespaces","fallbackNs","getFallbackLangs","lang","languagesFromStaticData","overrideCredentials","credentials","State","pluginService","getDefaultAndFallbackNs","runPromise","revert","getRequiredRecords","loadRequiredRecords","loadInitial","defaultLanguage","initializeLanguage","changeLanguage","forget","isLoaded","args","TolgeeCore","tolgeeChain","use","updateDefaults","tolgee","controller","withRestart","wasRunning","onNsUpdate","loadRecord","updateOptions","createTolgee","ERROR_PARAM_EMPTY","ERROR_UNEXPECTED_CHAR","ERROR_UNEXPECTED_END","FormatError","code","index","hint","isWhitespace","ch","test","STATE_TEXT","STATE_ESCAPE_MAYBE","STATE_ESCAPE","STATE_PARAM","STATE_PARAM_AFTER","END_STATES","CHAR_ESCAPE","ESCAPABLE","isAllowedInParam","char","texts","pars","param","parsingError","addText","addParam","formatParser","parameter","String","FormatSimple","tools","DEVTOOLS_ID","PREFERRED_LANGUAGES_LOCAL_STORAGE_KEY","TOLGEE_WRAPPED_ONLY_DATA_ATTRIBUTE","TOLGEE_RESTRICT_ATTRIBUTE","TOLGEE_ATTRIBUTE_NAME","TOLGEE_HIGHLIGHTER_CLASS","isSSR","globalThis","window","document","createElement","throwIfSSR","origin","initNodeMeta","oldTextContent","getNodeText","node","textContent","setNodeText","compareDescriptors","criteria","keyMatches","nsMatches","HIGHLIGHTER_BASE_STYLE","position","boxSizing","zIndex","Number","MAX_SAFE_INTEGER","contain","display","borderStyle","borderRadius","ElementHighlighter","initHighlighter","element","elementMeta","isConnected","clickable","el","getAttribute","parentElement","elementClickable","highlightEl","classList","style","borderColor","body","appendChild","shape","getBoundingClientRect","pointerEvents","borderWidth","top","left","width","height","initHighlightFunction","remove","initUnhighlightFunction","eCapture","capture","ePassive","passive","MODIFIER_MAP","MouseEventHandler","elementStore","keysDown","highlighted","cursorPosition","subscribedEvents","documentOrShadowRoot","targetElement","getRootNode","targetDocument","ownerDocument","meta","preventClean","updateHighlight","newHighlighted","areKeysDown","elements","findAncestor","getClosestTolgeeElement","elementsFromPoint","x","y","updateCursorPosition","updateModifiers","modifier","modifierProperty","blockEvents","id","stopPropagation","preventDefault","onMouseMove","clientX","clientY","onKeyDown","onKeyUp","onScroll","handleClick","subscribe","type","listener","addEventListener","func","removeEventListener","ElementRegistry","elementHighlighter","eventHandler","getKeysAndDefaults","isRestricted","tagName","toLowerCase","closest","cleanElement","removeAttribute","nodes","values","reduce","acc","curr","k","getKeyOptions","register","nodeMeta","tolgeeElement","initElementMeta","setAttribute","forEachElement","cleanupLingeringKeyAttributes","nodeType","Node","ATTRIBUTE_NODE","attr","ownerElement","cleanupRemovedNodes","removedNodes","cleanElementInactiveNodes","findAll","_","GeneralObserver","instance","isObserving","registredElements","ElementStore","createRunningInstance","wrapper","domHelper","getSuitableParent","domParent","getParentElement","tagNameEquals","elementTagName","DomHelper","nodeHandler","handleAttributes","includeChild","tag","attributes","toUpperCase","ELEMENT_NODE","concat","attrName","hasAttribute","getAttributeNode","attrNode","testAttribute","walker","createTreeWalker","NodeFilter","SHOW_ELEMENT","f","some","FILTER_ACCEPT","FILTER_SKIP","nextNode","currentNode","handleChildList","flatMap","n","handleText","TEXT_NODE","testTextNode","SHOW_TEXT","NodeHandler","elementRegistry","handleNodes","textNode","parent","handleKeyAttributeAttr","keyAttributeOnly","handleKeyAttribute","MutationObserver","mutationsList","m","removedNodesSet","treeWalker","attributeName","mutation","addedNodes","monitorAttributeList","attrs","observe","attributeFilter","childList","subtree","characterData","disconnect","sort","a","b","compareDocumentPosition","DOCUMENT_POSITION_FOLLOWING","keyName","keyNamespace","scope","h","r","Math","min","Uint16Array","o","subarray","fromCharCode","apply","d","l","c","u","Buffer","A","max","Uint8Array","charCodeAt","v","encoding","encode","stream","O","Blob","URL","createObjectURL","S","T","buffer","byteOffset","byteLength","toString","XMLHttpRequest","open","send","responseText","revokeObjectURL","U","E","g","fatal","isEncoding","RangeError","ignoreBOM","decode","ArrayBuffer","TextEncoder","TextDecoder","global","assert","FastTextEncoding","INVISIBLE_CHARACTERS","INVISIBLE_REGEX","RegExp","encodeMessage","bytes","toBytes","binary","byte","needsToAdd","repeat","padToWholeBytes","decodeMessage","textBytes","character","match","codes","parseInt","InvisibleWrapper","keyMemory","valueToNumber","numberToValue","num","ValueMemory","encodeValue","JSON","stringify","encodeWithSeparator","keysAndParams","invisibleMessages","decodeFromText","encodedValue","messages","valueCode","retrieveMessages","decodedVal","parse","decodeValue","removeSecrets","invisibleMark","_c","attribute","isCharEscaped","fullString","escapeCharsCount","TextWrapper","getTranslatedWithMetadata","unwrappedString","escaped","actual","paramName","readingState","addNamespace","parseUnwrapped","translated","escapeForRegExp","string","escapeParam","paramString","defaultString","nsArray","matchRegexp","matched","start","exec","pre","fullMatch","wrapped","unwrapped","substr","substring","ObserverPlugin","__spreadProps","__spreadValues","elMeta","alphabet","readChar","idx","base32Decode","bits","output","bufView","addition","pow","arrayBufferToString","getProjectIdFromApiKey","prefix","createUrl","parts","base","location","part","path","joinUrls","DevBackend","pId","searchParams","append","getApiKeyType","next","revalidate","ok","json","statusText","sendAndRecieve","recievingMessage","attempts","timeout","cancelled","makeAttempt","reject","clearTimeout","timer","postMessage","cancel","getData","injectPromise","loadInContextLib","src","script","head","API_KEY_LOCAL_STORAGE","API_URL_LOCAL_STORAGE","getCredentials","sessionStorage","getItem","clearSessionStorage","removeItem","BrowserExtensionPlugin","err","sessionStorageAvailable","handshaker","cancelLast","update","Handshaker","uiPresent","uiVersion","mode","config","readyState","InContextTools","getTolgeePlugin","CURRENT_LANGUAGE_LOCAL_STORAGE_KEY","LanguageStorage","localStorage","setItem","exactMatch","getTwoLetters","fullTag","preferredTwoLetter","twoLetterMatch","LanguageDetector","navigator","detectLanguageFromHeaders","acceptLanguageHeader","locales","locale","localePart","trim","getHeaderLanguages","trimSlashes","endsWith","DEFAULT_OPTIONS","getPath","Accept","fallbackOnFail","createBackendFetch","fetchOptions","__objRest","ms","signal","AbortController","_resolve","_reject","done","rejectWithTimout","abort","finally","fetchWithTimeout","status","BackendFetch","Tolgee","DevTools"],"mappings":"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","x_google_ignoreList":[12]}