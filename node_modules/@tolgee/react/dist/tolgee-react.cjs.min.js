"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@tolgee/web");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e);function s(n,r,s,o=!0){const[a]=e.useState((()=>{return e=n,Object.assign(Object.assign({},e),{t(...n){const r=t.getTranslateProps(...n);return e.t(Object.assign(Object.assign({},r),{noWrap:!0}))}});var e})),[u,l]=e.useState(o);return e.useEffect((()=>{l(!1)}),[]),e.useMemo((()=>{o&&(n.setEmitterActive(!1),n.addStaticData(s),n.changeLanguage(r),n.setEmitterActive(!0))}),[r,s,n]),e.useState((()=>{if(!n.isLoaded()&&o){const e=n.getRequiredRecords(r).map((({namespace:e,language:t})=>e?`${e}:${t}`:t)).filter((e=>!(null==s?void 0:s[e])));console.warn(`Tolgee: Missing records in "staticData" for proper SSR functionality: ${e.map((e=>`"${e}"`)).join(", ")}`)}})),u?a:n}const o={useSuspense:!0};let a;const u=()=>(a||(a=r.default.createContext(void 0)),a);let l;let c;const i=()=>{const t=u(),n=e.useContext(t)||c;if(!n)throw new Error("Couldn't find tolgee instance, did you forgot to use `TolgeeProvider`?");return n},d=()=>{const[t,n]=e.useState(0);return{instance:t,rerender:e.useCallback((()=>{n((e=>e+1))}),[n])}},f=(n,r)=>{const{tolgee:s,options:o}=i(),a=t.getFallback(n),u=t.getFallbackArray(a).join(":"),l=Object.assign(Object.assign({},o),r),{rerender:c,instance:f}=d(),g=e.useRef(),p=e.useRef([]);p.current=[];const b=s.isLoaded(a);e.useEffect((()=>{const e=s.onNsUpdate(c);return g.current=e,e.subscribeNs(a),p.current.forEach((t=>{e.subscribeNs(t)})),()=>{e.unsubscribe()}}),[u,s]),e.useEffect((()=>(s.addActiveNs(a),()=>s.removeActiveNs(a))),[u,s]);const v=e.useCallback((e=>{var t;const n=null!==(t=e.ns)&&void 0!==t?t:null==a?void 0:a[0];return(e=>{var t;p.current.push(e),null===(t=g.current)||void 0===t||t.subscribeNs(e)})(n),s.t(Object.assign(Object.assign({},e),{ns:n}))}),[s,f]);if(l.useSuspense&&!b)throw s.addActiveNs(a,!0);return{t:v,isLoading:!b}};const g=e=>{if(!e)return;const t={};return Object.entries(e||{}).forEach((([e,n])=>{if("function"==typeof n)t[e]=e=>n(p(e));else if(r.default.isValidElement(n)){const s=n;t[e]=e=>void 0===s.props.children&&(null==e?void 0:e.length)?r.default.cloneElement(s,{},p(e)):r.default.cloneElement(s)}else t[e]=n})),t},p=e=>{const t=(n=e,Array.isArray(n)&&1===n.length?n[0]:n);var n;return Array.isArray(t)?t.map(((e,t)=>r.default.createElement(r.default.Fragment,{key:t},e))):t},b=e=>{const t=e.keyName||e.children;void 0===t&&console.error("T component: keyName not defined");const n=e.defaultValue||(e.keyName?e.children:void 0),s=p(e.t({key:t,params:g(e.params),defaultValue:n,noWrap:e.noWrap,ns:e.ns,language:e.language}));return r.default.createElement(r.default.Fragment,null,s)};exports.GlobalContextPlugin=e=>t=>(c={tolgee:t,options:Object.assign(Object.assign({},o),e)},t),exports.T=e=>{const{t:t}=f();return r.default.createElement(b,Object.assign({t:t},e))},exports.TBase=b,exports.TolgeeProvider=({tolgee:t,options:n,children:a,fallback:c,ssr:i})=>{e.useEffect((()=>{(null==l?void 0:l.run)!==t.run&&(l&&l.stop(),l=t,t.run().catch((e=>{console.error(e)})).finally((()=>{b(!1)})))}),[t]);let d=t;const{language:f,staticData:g}="object"!=typeof i?{}:i;d=s(t,f,g,Boolean(i));const[p,b]=e.useState(!d.isLoaded()),v=Object.assign(Object.assign({},o),n),m=u();return v.useSuspense?r.default.createElement(m.Provider,{value:{tolgee:d,options:v}},p?c:r.default.createElement(e.Suspense,{fallback:c||null},a)):r.default.createElement(m.Provider,{value:{tolgee:d,options:v}},p?c:a)},exports.getProviderInstance=u,exports.useTolgee=t=>{const{tolgee:n}=i(),{rerender:r}=d();return e.useEffect((()=>{const e=null==t?void 0:t.map((e=>n.on(e,r)));return()=>{null==e||e.forEach((e=>e.unsubscribe()))}}),[null==t?void 0:t.join(":")]),n},exports.useTolgeeSSR=s,exports.useTranslate=(n,r)=>{const{t:s,isLoading:o}=f(n,r);return{t:e.useCallback(((...e)=>{const n=t.getTranslateProps(...e);return s(n)}),[s]),isLoading:o}},Object.keys(t).forEach((function(e){"default"===e||exports.hasOwnProperty(e)||Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})}));
//# sourceMappingURL=tolgee-react.cjs.min.js.map
